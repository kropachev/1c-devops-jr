<!doctype html><html lang=ru-RU dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="DevOps, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–¢–µ–ø–µ—Ä—å –≤ Kubernetes) –§–∞–π–ª &lsquo;Home.md&rsquo; –Ω–µ –Ω–∞–π–¥–µ–Ω.\n–í–≤–µ–¥–µ–Ω–∏–µ –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å CI –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è 1–° —Å –Ω—É–ª—è –Ω–∞ –æ–¥–Ω–æ–π Ubuntu –º–∞—à–∏–Ω–µ.\nüí° –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª Kubernetes –∏ CI/CD.\n–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —É –≤–∞—Å –±—É–¥–µ—Ç:\n&ldquo;–õ–µ–≥–∫–∏–π&rdquo; Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä K3s Jenkins —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏ SonarQube –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ Docker Registry –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ Portainer –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Kubernetes –ü–æ—á–µ–º—É Kubernetes Swarm-–ø–ª–∞–≥–∏–Ω Jenkins –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∞ Kubernetes —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.\n–ü–æ–∫–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –±—ã–ª –≤—ã–ø—É—â–µ–Ω, –∏–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω, –Ω–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω - https://plugins.jenkins.io/swarm-agents-cloud/. –ù–æ –ø–æ–±–µ–¥–∏–ª–∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å, —Ç—è–≥–∞ –∫ –Ω–æ–≤–æ–º—É –∏ –≤–æ–æ–±—â–µ.\n–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –±—É–¥–µ–º K3s - –æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ Kubernetes, –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.\n"><title>–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</title><link rel=canonical href=https://1c-devops-jr.kropachev.digital/p/wiki/><link rel=stylesheet href=/scss/style.min.6a692fd055deae459f2a9767f57f3855ba80cafd5041317f24f7360f6ca47cdf.css><meta property='og:title' content="–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"><meta property='og:description' content="DevOps, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–¢–µ–ø–µ—Ä—å –≤ Kubernetes) –§–∞–π–ª &lsquo;Home.md&rsquo; –Ω–µ –Ω–∞–π–¥–µ–Ω.\n–í–≤–µ–¥–µ–Ω–∏–µ –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å CI –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è 1–° —Å –Ω—É–ª—è –Ω–∞ –æ–¥–Ω–æ–π Ubuntu –º–∞—à–∏–Ω–µ.\nüí° –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª Kubernetes –∏ CI/CD.\n–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —É –≤–∞—Å –±—É–¥–µ—Ç:\n&ldquo;–õ–µ–≥–∫–∏–π&rdquo; Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä K3s Jenkins —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏ SonarQube –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ Docker Registry –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ Portainer –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Kubernetes –ü–æ—á–µ–º—É Kubernetes Swarm-–ø–ª–∞–≥–∏–Ω Jenkins –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∞ Kubernetes —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.\n–ü–æ–∫–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –±—ã–ª –≤—ã–ø—É—â–µ–Ω, –∏–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω, –Ω–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω - https://plugins.jenkins.io/swarm-agents-cloud/. –ù–æ –ø–æ–±–µ–¥–∏–ª–∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å, —Ç—è–≥–∞ –∫ –Ω–æ–≤–æ–º—É –∏ –≤–æ–æ–±—â–µ.\n–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –±—É–¥–µ–º K3s - –æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ Kubernetes, –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.\n"><meta property='og:url' content='https://1c-devops-jr.kropachev.digital/p/wiki/'><meta property='og:site_name' content='1C DevOps Jr'><meta property='og:type' content='article'><meta property='article:section' content='P'><meta name=twitter:title content="–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"><meta name=twitter:description content="DevOps, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–¢–µ–ø–µ—Ä—å –≤ Kubernetes) –§–∞–π–ª &lsquo;Home.md&rsquo; –Ω–µ –Ω–∞–π–¥–µ–Ω.\n–í–≤–µ–¥–µ–Ω–∏–µ –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å CI –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è 1–° —Å –Ω—É–ª—è –Ω–∞ –æ–¥–Ω–æ–π Ubuntu –º–∞—à–∏–Ω–µ.\nüí° –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª Kubernetes –∏ CI/CD.\n–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —É –≤–∞—Å –±—É–¥–µ—Ç:\n&ldquo;–õ–µ–≥–∫–∏–π&rdquo; Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä K3s Jenkins —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏ SonarQube –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞ Docker Registry –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤ Portainer –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Kubernetes –ü–æ—á–µ–º—É Kubernetes Swarm-–ø–ª–∞–≥–∏–Ω Jenkins –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∞ Kubernetes —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.\n–ü–æ–∫–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –±—ã–ª –≤—ã–ø—É—â–µ–Ω, –∏–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω, –Ω–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω - https://plugins.jenkins.io/swarm-agents-cloud/. –ù–æ –ø–æ–±–µ–¥–∏–ª–∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å, —Ç—è–≥–∞ –∫ –Ω–æ–≤–æ–º—É –∏ –≤–æ–æ–±—â–µ.\n–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –±—É–¥–µ–º K3s - –æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ Kubernetes, –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.\n"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_b5976aa1afdc1d2e.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>1C DevOps Jr</a></h1><h2 class=site-description></h2></div></header><ol class=menu id=main-menu><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#devops-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-—Ç–µ–ø–µ—Ä—å-–≤-kubernetes>DevOps, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–¢–µ–ø–µ—Ä—å –≤ Kubernetes)</a></li><li><a href=#–≤–≤–µ–¥–µ–Ω–∏–µ>–í–≤–µ–¥–µ–Ω–∏–µ</a><ul><li><a href=#–ø–æ—á–µ–º—É-kubernetes>–ü–æ—á–µ–º—É Kubernetes</a></li><li><a href=#dns-–∏-https-–≤–∞–∂–Ω–æ–µ-–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ>DNS –∏ HTTPS, –≤–∞–∂–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</a></li><li><a href=#dns-–¥–ª—è-—Å–µ—Ä–≤–µ—Ä–∞>DNS –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞</a></li></ul></li><li><a href=#-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞-–∏-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-kubernetes-k3s>‚ò∏Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Kubernetes (K3s)</a><ul><li><a href=#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</a></li><li><a href=#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</a></li><li><a href=#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-k3s>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ k3s</a></li><li><a href=#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-helm>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Helm</a></li><li><a href=#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-kubectl>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ kubectl</a></li><li><a href=#https-–¥–ª—è-—Å–µ—Ä–≤–∏—Å–æ–≤-–≤-k3s>HTTPS –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ k3s</a></li><li><a href=#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-1>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</a></li><li><a href=#root-ca>Root CA</a></li><li><a href=#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-root-ca-–≤-–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ-–Ω–∞-—É–∑–ª–∞—Ö-k3s>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Root CA –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –Ω–∞ —É–∑–ª–∞—Ö k3s</a></li><li><a href=#traefik---—É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ-—Ç–∞–π–º–∞—É—Ç—ã-–æ—à–∏–±–∫–∞-504-–Ω–∞-–±–æ–ª—å—à–∏—Ö-–∑–∞–ø—Ä–æ—Å–∞—Ö>Traefik - —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã (–æ—à–∏–±–∫–∞ 504 –Ω–∞ –±–æ–ª—å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö)</a></li><li><a href=#–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-–Ω–∞—Å—Ç—Ä–æ–µ–∫-–ø—Ä–∏-—É—Å—Ç–∞–Ω–æ–≤–∫–µ-—Å–µ—Ä–≤–∏—Å–æ–≤>–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–∏—Å–æ–≤</a></li></ul></li><li><a href=#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</a><ul><li><a href=#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-portainer>üèóÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Portainer</a></li><li><a href=#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-docker-registry>üê≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Registry</a></li><li><a href=#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-gitlab>ü¶ä –£—Å—Ç–∞–Ω–æ–≤–∫–∞ GitLab</a></li><li><a href=#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-2>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-namespace>–°–æ–∑–¥–∞–µ–º namespace</a></li><li><a href=#tls-secret-–∏–∑-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞>TLS Secret –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</a></li><li><a href=#—Ñ–∏–∫—Å–∏—Ä—É–µ–º-ssh-host-keys-–∫–∞–∫-kubernetes-secrets>–§–∏–∫—Å–∏—Ä—É–µ–º SSH host keys –∫–∞–∫ Kubernetes Secrets</a></li><li><a href=#–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º-traefik-–¥–ª—è-ssh-tcp-–ø–æ—Ä—Ç–∞-gitlab>–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Traefik –¥–ª—è SSH (TCP) –ø–æ—Ä—Ç–∞ GitLab</a></li><li><a href=#–≥–æ—Ç–æ–≤–∏–º-valuesyaml-–¥–ª—è-gitlab-helm-chart>–ì–æ—Ç–æ–≤–∏–º values.yaml –¥–ª—è GitLab Helm Chart</a></li><li><a href=#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-gitlab-—á–µ—Ä–µ–∑-helm>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ GitLab —á–µ—Ä–µ–∑ Helm</a></li><li><a href=#–ø–µ—Ä–≤—ã–π-–≤—Ö–æ–¥-–≤-gitlab>–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –≤ GitLab</a></li><li><a href=#–ø—Ä–æ–≤–µ—Ä—è–µ–º-git-clone-–ø–æ-https-–∏-ssh>–ü—Ä–æ–≤–µ—Ä—è–µ–º Git clone –ø–æ HTTPS –∏ SSH</a></li></ul></li><li><a href=#–æ—à–∏–±–∫–∞-ssl-certificate-problem-unable-to-get-local-issuer-certificate-1>–û—à–∏–±–∫–∞ SSL certificate problem: unable to get local issuer certificate</a><ul><li><a href=#linux-ubuntu>Linux (Ubuntu)</a></li><li><a href=#windows-git-for-windows>Windows (Git for Windows)</a></li><li><a href=#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-sonarqube>üõú –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SonarQube</a></li><li><a href=#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Ö–æ—Å—Ç–∞>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö–æ—Å—Ç–∞</a></li><li><a href=#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-3>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-namespace-1>–°–æ–∑–¥–∞–µ–º namespace</a></li><li><a href=#tls-secret-–∏–∑-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞-1>TLS Secret –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</a></li><li><a href=#secret-monitoring-passcode>Secret Monitoring passcode</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-valuesyaml-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∏>–°–æ–∑–¥–∞–µ–º values.yaml (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏)</a></li><li><a href=#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-sonarsource-—á–µ—Ä–µ–∑-helm>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ SonarSource —á–µ—Ä–µ–∑ Helm</a></li><li><a href=#–ø–µ—Ä–≤—ã–π-–≤—Ö–æ–¥-–∏-–ø–∞—Ä–æ–ª–∏>–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –∏ –ø–∞—Ä–æ–ª–∏</a></li><li><a href=#–ø—Ä–æ–≤–µ—Ä–∫–∏-–ø–æ—Å–ª–µ-—É—Å—Ç–∞–Ω–æ–≤–∫–∏>–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏</a></li><li><a href=#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-jenkins>ü•∏ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Jenkins</a></li><li><a href=#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-4>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-namespace-jenkins>–°–æ–∑–¥–∞–µ–º namespace <code>jenkins</code></a></li><li><a href=#tls-secret-–∏–∑-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞-2>TLS Secret –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-configmap-—Å-–∫–æ—Ä–Ω–µ–≤—ã–º-ca-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º>–°–æ–∑–¥–∞–µ–º ConfigMap —Å –∫–æ—Ä–Ω–µ–≤—ã–º CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º</a></li><li><a href=#–¥–æ–±–∞–≤–ª—è–µ–º-helm-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π-jenkins>–î–æ–±–∞–≤–ª—è–µ–º Helm-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Jenkins</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-persistentvolume-–∏-storageclass>–°–æ–∑–¥–∞–µ–º PersistentVolume –∏ StorageClass</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-serviceaccount-–∏-rbac>–°–æ–∑–¥–∞–µ–º ServiceAccount –∏ RBAC</a></li><li><a href=#–≥–æ—Ç–æ–≤–∏–º-jenkins-valuesyaml>–ì–æ—Ç–æ–≤–∏–º <code>jenkins-values.yaml</code></a></li><li><a href=#—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º-jenkins>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Jenkins</a></li><li><a href=#–ø–æ–ª—É—á–∞–µ–º-–ø–∞—Ä–æ–ª—å-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞>–ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a></li><li><a href=#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-jenkins-url-–¥–ª—è-kubernetes-–∞–≥–µ–Ω—Ç–æ–≤>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins URL –¥–ª—è Kubernetes-–∞–≥–µ–Ω—Ç–æ–≤</a></li><li><a href=#–ø–ª–∞–≥–∏–Ω—ã-–∫–æ—Ç–æ—Ä—ã–µ-–Ω—É–∂–Ω–æ-—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å>–ü–ª–∞–≥–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</a></li><li><a href=#–æ—Ç–∫–ª—é—á–∞–µ–º-–ø–ª–∞–≥–∏–Ω—ã-–∏–∑-—Å–ø–∏—Å–∫–∞>–û—Ç–∫–ª—é—á–∞–µ–º –ø–ª–∞–≥–∏–Ω—ã –∏–∑ —Å–ø–∏—Å–∫–∞</a></li></ul></li><li><a href=#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-jenkins>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins</a><ul><li><a href=#–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-kubernetes-–¥–ª—è-–∞–≥–µ–Ω—Ç–æ–≤>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Kubernetes –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤</a></li><li><a href=#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-5>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-–æ—Ç–¥–µ–ª—å–Ω—ã–π-namespace-–¥–ª—è-jenkins-–∞–≥–µ–Ω—Ç–æ–≤>–°–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π namespace –¥–ª—è Jenkins-–∞–≥–µ–Ω—Ç–æ–≤</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-—Å–µ–∫—Ä–µ—Ç-—Å-—É—á–µ—Ç–Ω—ã–º–∏-–¥–∞–Ω–Ω—ã–º–∏-–¥–ª—è-–¥–æ—Å—Ç—É–ø–∞-–∫-registry>–°–æ–∑–¥–∞–µ–º —Å–µ–∫—Ä–µ—Ç —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ registry</a></li><li><a href=#serviceaccount-–¥–ª—è-jenkins-–∞–≥–µ–Ω—Ç–æ–≤>ServiceAccount –¥–ª—è Jenkins-–∞–≥–µ–Ω—Ç–æ–≤</a></li><li><a href=#–ø—Ä–∞–≤–∞-–¥–ª—è-—Å–æ–∑–¥–∞–Ω–∏—è-–∏-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è-pod-–∞–º–∏-rbac>–ü—Ä–∞–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Pod-–∞–º–∏ (RBAC)</a></li><li><a href=#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-ca-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</a></li><li><a href=#jenkins-–¥–æ–±–∞–≤–ª—è–µ–º-kubernetes-cloud>Jenkins: –¥–æ–±–∞–≤–ª—è–µ–º Kubernetes Cloud</a></li><li><a href=#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-jenkins-–∞–≥–µ–Ω—Ç–æ–≤-1—Å>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins –∞–≥–µ–Ω—Ç–æ–≤ 1–°</a></li><li><a href=#–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-docker-–æ–±—Ä–∞–∑–∞-jenkins-–∞–≥–µ–Ω—Ç–∞-1—Å>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ Jenkins-–∞–≥–µ–Ω—Ç–∞ 1–°</a></li><li><a href=#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-jenkins-–∞–≥–µ–Ω—Ç–∞-–≤-jenkins-pod-template>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Jenkins-–∞–≥–µ–Ω—Ç–∞ –≤ Jenkins (Pod Template)</a></li><li><a href=#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-jenkins-–∞–≥–µ–Ω—Ç–æ–≤-sonarqube>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins –∞–≥–µ–Ω—Ç–æ–≤ SonarQube</a></li><li><a href=#–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-—Ç–æ–∫–µ–Ω–∞-–≤-sonarqube>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ SonarQube</a></li><li><a href=#–¥–æ–±–∞–≤–ª—è–µ–º-sonarqube-–≤-jenkins>–î–æ–±–∞–≤–ª—è–µ–º SonarQube –≤ Jenkins</a></li><li><a href=#–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–∞–≥–µ–Ω—Ç–∞-–≤-jenkins-pod-template>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –≤ Jenkins (Pod Template)</a></li><li><a href=#–ø–æ–¥–∫–ª—é—á–∞–µ–º-jenkins-lib>–ü–æ–¥–∫–ª—é—á–∞–µ–º Jenkins-lib</a></li><li><a href=#–ø–æ–¥–∫–ª—é—á–∞–µ–º-–Ω–æ–≤—ã–π-–ø—Ä–æ–µ–∫—Ç-–∫-–ø–∞–π–ø–ª–∞–π–Ω—É>–ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∫ –ø–∞–π–ø–ª–∞–π–Ω—É</a></li><li><a href=#—Å–æ–∑–¥–∞–µ–º-–ø—Ä–æ–µ–∫—Ç-–≤-gitlab>–°–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç –≤ GitLab</a></li><li><a href=#–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞-–≤-–ª–æ–∫–∞–ª—å–Ω—ã–π-–∫–∞—Ç–∞–ª–æ–≥>–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥</a></li><li><a href=#gitsync-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞-1—Å-–∏-git>Gitsync, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –•—Ä–∞–Ω–∏–ª–∏—â–∞ 1–° –∏ Git</a></li><li><a href=#–¥–æ–±–∞–≤–ª—è–µ-–ø–∞–π–ø–ª–∞–π–Ω-–≤-jenkins>–î–æ–±–∞–≤–ª—è–µ –ø–∞–π–ø–ª–∞–π–Ω –≤ Jenkins</a></li></ul></li><li><a href=#faq>FAQ</a><ul><li><a href=#–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å-—Å–ø–∏—Å–æ–∫-namespace>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ namespace</a></li><li><a href=#–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å-—Å–ø–∏—Å–æ–∫-–ø–æ–¥–æ–≤-–≤-namespace>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–¥–æ–≤ –≤ namespace</a></li><li><a href=#–ø—Ä–æ–≤–µ—Ä–∏—Ç—å-—Å—Ç–∞—Ç—É—Å-–ø–æ–¥–∞>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∞</a></li><li><a href=#—É–¥–∞–ª–∏—Ç—å-–ø–æ–¥>–£–¥–∞–ª–∏—Ç—å –ø–æ–¥</a></li></ul></li><li><a href=#—É–¥–∞–ª—è–µ–º-helm-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–∏–∑-k3s>–£–¥–∞–ª—è–µ–º Helm-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ k3s</a><ul><li><a href=#–≤–∞—Ä–∏–∞–Ω—Ç-a-–±—ã—Å—Ç—Ä—ã–π-reset-—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è>–í–∞—Ä–∏–∞–Ω—Ç A. –ë—ã—Å—Ç—Ä—ã–π reset (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</a></li><li><a href=#–≤–∞—Ä–∏–∞–Ω—Ç-b-–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ-—É–¥–∞–ª–µ–Ω–∏–µ-shared--prod-namespace>–í–∞—Ä–∏–∞–Ω—Ç B. –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (shared / prod namespace)</a></li><li><a href=#–ø—Ä–æ–≤–µ—Ä–∫–∞-—á—Ç–æ-gitlab-—É–¥–∞–ª–µ–Ω-–ø–æ–ª–Ω–æ—Å—Ç—å—é>–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ GitLab —É–¥–∞–ª–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é</a></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/wiki/>–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>35 minute read</time></div></footer></div></header><section class=article-content><h2 id=devops-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç-—Ç–µ–ø–µ—Ä—å-–≤-kubernetes>DevOps, –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–¢–µ–ø–µ—Ä—å –≤ Kubernetes)</h2><p><em>–§–∞–π–ª &lsquo;Home.md&rsquo; –Ω–µ –Ω–∞–π–¥–µ–Ω.</em></p><h2 id=–≤–≤–µ–¥–µ–Ω–∏–µ>–í–≤–µ–¥–µ–Ω–∏–µ</h2><p>–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ–º–æ–∂–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å CI –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è 1–° —Å –Ω—É–ª—è –Ω–∞ –æ–¥–Ω–æ–π Ubuntu –º–∞—à–∏–Ω–µ.<br>üí° –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª Kubernetes –∏ CI/CD.</p><p>–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —É –≤–∞—Å –±—É–¥–µ—Ç:</p><ul><li>&ldquo;–õ–µ–≥–∫–∏–π&rdquo; Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä K3s</li><li>Jenkins —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏</li><li>SonarQube –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∫–∞—á–µ—Å—Ç–≤–∞</li><li>Docker Registry –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ–±—Ä–∞–∑–æ–≤</li><li>Portainer –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Kubernetes</li></ul><h3 id=–ø–æ—á–µ–º—É-kubernetes>–ü–æ—á–µ–º—É Kubernetes</h3><p>Swarm-–ø–ª–∞–≥–∏–Ω Jenkins –±–æ–ª—å—à–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è, –∞ Kubernetes —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.<br>–ü–æ–∫–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å —ç—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –±—ã–ª –≤—ã–ø—É—â–µ–Ω, –∏–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω, –Ω–æ–≤—ã–π –ø–ª–∞–≥–∏–Ω - <a class=link href=https://plugins.jenkins.io/swarm-agents-cloud/ target=_blank rel=noopener>https://plugins.jenkins.io/swarm-agents-cloud/</a>. –ù–æ –ø–æ–±–µ–¥–∏–ª–∏ —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∏–Ω—Ç–µ—Ä–µ—Å, —Ç—è–≥–∞ –∫ –Ω–æ–≤–æ–º—É –∏ –≤–æ–æ–±—â–µ.<br>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –±—É–¥–µ–º K3s - –æ–±–ª–µ–≥—á–µ–Ω–Ω–∞—è —Å–±–æ—Ä–∫–∞ Kubernetes, –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞.</p><h3 id=dns-–∏-https-–≤–∞–∂–Ω–æ–µ-–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ>DNS –∏ HTTPS, –≤–∞–∂–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ</h3><p>–ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–º —Å—Ç–µ–Ω–¥–µ –º—ã –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º CI –ø–æ HTTPS, –ø—Ä—è–º–æ –∫–∞–∫ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.</p><p>–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ–¥–∞, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –æ—Ç –ø—É–±–ª–∏—á–Ω–æ–≥–æ CA, –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –∫–æ–Ω—Ç—É—Ä–µ, –¥–ª—è –ª–∏—á–Ω—ã—Ö —Ü–µ–ª–µ–π, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –º—ã –≤—ã–ø—É—Å—Ç–∏–º —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π Root CA.</p><blockquote><p>‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ: –≤—Å—è –¥–∞–ª—å–Ω–µ–π—à–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç, —á—Ç–æ –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º –±—É–¥–µ—Ç –æ—Å—É—â–µ—Å—Ç–≤–ª—è—Ç—å—Å—è –ø–æ –¥–æ–º–µ–Ω–Ω—ã–º –∏–º–µ–Ω–∞–º, –∞ –Ω–µ –ø–æ IP.<br>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π DNS Kubernetes (CoreDNS) —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–µ –∏–º–µ–Ω –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.<br>–°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –¥–æ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—Ç–µ–Ω–¥–∞ (–≤ –ø—Ä–∏–º–µ—Ä–µ - *.onecci.lan) –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º DNS-—Å–µ—Ä–≤–µ—Ä–µ —Å–µ—Ç–∏ (–∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ, —Å–º. —Ä–∞–∑–¥–µ–ª <strong>DNS –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞</strong>).</p></blockquote><h4 id=–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-—Ä–µ—à–µ–Ω–∏—è>–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è</h4><ul><li>–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º k3s</li><li>–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Traefik (Ingress-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ k3s)</li><li>–¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ –¥–æ–º–µ–Ω–Ω—ã–º –∏–º–µ–Ω–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä jenkins.onecci.lan)</li><li>–æ–¥–∏–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤</li><li>—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–¥–ø–∏—Å–∞–Ω —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º Root CA</li><li>Root CA —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –Ω–∞ —É–∑–ª–∞—Ö k3s (–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –º–∞—à–∏–Ω–∞—Ö)</li><li>—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Kubernetes Secret</li><li>TLS –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –Ω–∞ Ingress (Traefik), –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ HTTP –∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏.</li><li>–í –±—Ä–∞—É–∑–µ—Ä–µ –±—É–¥–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ (–∏–ª–∏ –Ω–µ –±—É–¥–µ—Ç, –µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏–º Root CA)</li></ul><h4 id=–∫–∞–∫-—ç—Ç–æ-—Ä–∞–±–æ—Ç–∞–µ—Ç>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h4><ol><li>–í –±—Ä–∞—É–∑–µ—Ä–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ <code>https://jenkins.onecci.lan</code></li><li>TLS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å Traefik:<ul><li>Traefik –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏–∑ Kubernetes Secret;</li><li>–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ SAN –∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞.</li></ul></li><li>Traefik —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç HTTPS –∏ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å: <code>HTTP -> Service -> Pod</code></li><li>Jenkins (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å) –ø–æ–ª—É—á–∞–µ—Ç –æ–±—ã—á–Ω—ã–π HTTP-–∑–∞–ø—Ä–æ—Å.</li></ol><h4 id=—á—Ç–æ-–º—ã-–ø–æ–ª—É—á–∏–º>–ß—Ç–æ –º—ã –ø–æ–ª—É—á–∏–º</h4><ul><li>–æ–¥–∏–Ω TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ –≤–µ—Å—å CI-–∫–æ–Ω—Ç—É—Ä;</li><li>–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ —Ç—Ä–µ–±—É—é—Ç TLS-–Ω–∞—Å—Ç—Ä–æ–µ–∫ (–Ω—É, –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞);</li><li>—É–ø—Ä–æ—â–∞–µ—Ç—Å—è —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤;</li><li>–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∞ –∫ –ø—Ä–æ–¥—É.</li></ul><h3 id=dns-–¥–ª—è-—Å–µ—Ä–≤–µ—Ä–∞>DNS –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞</h3><p>–ü–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π Ingress –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π DNS-—Ä–µ–∑–æ–ª–≤–∏–Ω–≥ –∏–º–µ–Ω —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ IP –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã —Å Kubernetes.</p><h4 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-dns-–≤-openwrt>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DNS –≤ OpenWRT</h4><p>–ù–∞ —Ä–æ—É—Ç–µ—Ä–∞—Ö OpenWRT —ç—Ç–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ <strong>Network</strong> - <strong>DHCP and DNS</strong> - <strong>General</strong>, –≤ –ø–æ–ª–µ <strong>Address</strong> –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞:</p><ul><li><code>/onecci.lan/192.168.1.50</code> - –¥–ª—è ipv4</li><li><code>/onecci.lan/::ffff:192.168.1.50</code> - –¥–ª—è ipv6 (<code>::ffff:</code> –ø–ª—é IP v4)</li></ul><p>–í–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ä–æ—É—Ç–µ—Ä, —á—Ç–æ–±—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å.</p><p>–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nslookup onecci.lan
</span></span><span style=display:flex><span>nslookup subtest.onecci.lan
</span></span></code></pre></div><p>–ò –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤—Å–µ –ø–æ–¥–¥–æ–º–µ–Ω—ã –¥–æ–ª–∂–Ω—ã —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ IP —Å–µ—Ä–≤–µ—Ä–∞.</p><h2 id=-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞-–∏-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-kubernetes-k3s>‚ò∏Ô∏è –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Kubernetes (K3s)</h2><p>–ú—ã —É—Å—Ç–∞–Ω–æ–≤–∏–º <strong>K3s</strong> - –æ–±–ª–µ–≥—á–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é Kubernetes, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –æ–¥–Ω–æ—Å–µ—Ä–≤–µ—Ä–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏.</p><p>–ß—Ç–æ –¥–µ–ª–∞–µ—Ç K3s</p><ul><li>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Kubernetes API –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã</li><li>–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç containerd - runtime –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤</li><li>–†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä —Å –æ–¥–Ω–∏–º —É–∑–ª–æ–º</li></ul><h3 id=–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Å–µ—Ä–≤–µ—Ä–∞>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</h3><p>–û–±–Ω–æ–≤–ª—è–µ–º –ø–∞–∫–µ—Ç—ã –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–∞–∑–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã (curl, wget, git), –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏.</p><p>–í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span><span style=display:flex><span>sudo apt upgrade -y
</span></span><span style=display:flex><span>sudo apt install -y curl wget git ca-certificates lsb-release
</span></span></code></pre></div><h4 id=—Å–æ–∑–¥–∞–µ–º-–≥—Ä—É–ø–ø—É-–¥–ª—è-–¥–æ—Å—Ç—É–ø–∞-–∫-kubernetes-–∏-—Ñ–∞–π–ª–∞–º-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏>–°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—É –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Kubernetes –∏ —Ñ–∞–π–ª–∞–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</h4><p>–°–æ–∑–¥–∞–¥–∏–º –æ—Ç–¥–µ–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º–Ω—É—é –≥—Ä—É–ø–ø—É, –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–æ —á–∏—Ç–∞—Ç—å kubeconfig –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo groupadd k3s
</span></span></code></pre></div><p>–î–æ–±–∞–≤—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–µ—Ä–≤–∏—Å–æ–º) –≤ —ç—Ç—É –≥—Ä—É–ø–ø—É:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usermod -aG k3s $USER
</span></span></code></pre></div><p>–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É <strong>–Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è</strong> –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>newgrp k3s
</span></span></code></pre></div><h3 id=–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</h3><p>–°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /k3s-1c-ci
</span></span></code></pre></div><p>–î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ –¥–ª—è –≥—Ä—É–ø–ø—ã <code>k3s</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chgrp -R k3s /k3s-1c-ci
</span></span><span style=display:flex><span>sudo chmod -R <span style=color:#ae81ff>2775</span> /k3s-1c-ci
</span></span></code></pre></div><h3 id=—É—Å—Ç–∞–Ω–æ–≤–∫–∞-k3s>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ k3s</h3><p>–ö–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sfL https://get.k3s.io | sh -
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo kubectl get nodes
</span></span></code></pre></div><p>–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —É–∑–µ–ª —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º <code>Ready</code>.</p><h3 id=—É—Å—Ç–∞–Ω–æ–≤–∫–∞-helm>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Helm</h3><p>Helm (–ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è Kubernetes) –Ω—É–∂–µ–Ω, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–∞–∫ Helm-—á–∞—Ä—Ç.</p><p>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Helm: <a class=link href=https://helm.sh/docs/intro/install target=_blank rel=noopener>https://helm.sh/docs/intro/install</a></p><p>–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç–æ–º Helm –∏ —Ä–∞–∑–º–µ—â–µ–Ω –≤ –∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ - <a class=link href=https://github.com/helm/helm/blob/main/scripts/get-helm-3 target=_blank rel=noopener>https://github.com/helm/helm/blob/main/scripts/get-helm-3</a></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 | bash
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm version
</span></span></code></pre></div><p>–û–∂–∏–¥–∞–µ–º —É–≤–∏–¥–µ—Ç—å <code>version.BuildInfo</code>&mldr;</p><h3 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-kubectl>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ kubectl</h3><p><em>–§–∞–π–ª &lsquo;03-01-configure-kubectl.md&rsquo; –Ω–µ –Ω–∞–π–¥–µ–Ω.</em></p><h3 id=https-–¥–ª—è-—Å–µ—Ä–≤–∏—Å–æ–≤-–≤-k3s>HTTPS –¥–ª—è —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ k3s</h3><p>–í –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞–º –≤—ã–¥–∞–¥—É—Ç –∫–æ–ª–ª–µ–≥–∏ –∏–∑ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –ê –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º—ã –≤—ã–ø—É—Å—Ç–∏–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–∞–º–∏.</p><div class=table-wrapper><table><thead><tr><th>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</th><th>–§–∞–π–ª</th><th>–ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è</th></tr></thead><tbody><tr><td><strong>TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–µ—Ä–≤–∏—Å–∞</strong></td><td><code>tls.crt</code> + <code>tls.key</code></td><td>Ingress / —Å–µ—Ä–≤–∏—Å—ã (HTTPS). TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω—É–∂–µ–Ω <strong>—Å–µ—Ä–≤–µ—Ä—É</strong>, —á—Ç–æ–±—ã –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTPS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</td></tr><tr><td><strong>–ö–æ—Ä–Ω–µ–≤–æ–π CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</strong></td><td><code>onecci-root-ca.crt</code></td><td>–ö–ª–∏–µ–Ω—Ç—ã (Jenkins, CI-–∞–≥–µ–Ω—Ç—ã, runners, git, curl). CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω—É–∂–µ–Ω <strong>–∫–ª–∏–µ–Ω—Ç—É</strong>, —á—Ç–æ–±—ã —Å—á–∏—Ç–∞—Ç—å —ç—Ç–æ—Ç TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–º</td></tr></tbody></table></div><h3 id=–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-1>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</h3><p>–°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –Ω–∞—à–∏—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /k3s-1c-ci/tls
</span></span><span style=display:flex><span>cd /k3s-1c-ci/tls
</span></span></code></pre></div><h3 id=root-ca>Root CA</h3><p>Root CA (–∫–æ—Ä–Ω–µ–≤–æ–π —Ü–µ–Ω—Ç—Ä —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∞–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
—Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç—É—Ä–∞ CI. Root CA —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –∏–º–µ–µ—Ç —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è.</p><ul><li>–ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ Kubernetes</li><li>–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ Ingress</li><li>—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –Ω–∞ —É–∑–ª–∞—Ö k3s</li><li>–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –º–∞—à–∏–Ω—ã (–±—Ä–∞—É–∑–µ—Ä—ã)</li></ul><p>–°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Root CA:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano openssl-root-ca.cnf
</span></span></code></pre></div><p>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ <code>openssl-root-ca.cnf</code>.<br>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ - –∑–¥–µ—Å—å –Ω–µ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è ip –∏–ª–∏ –∞–¥—Ä–µ—Å–∞ –Ω–∞—à–∏—Ö –¥–æ–º–µ–Ω–æ–≤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[ req ]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default_bits</span>       <span style=color:#f92672>=</span> <span style=color:#e6db74>4096</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>prompt</span>             <span style=color:#f92672>=</span> <span style=color:#e6db74>no</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default_md</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>sha256</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>distinguished_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>dn</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>x509_extensions</span>    <span style=color:#f92672>=</span> <span style=color:#e6db74>v3_ca</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[ dn ]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>C</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>RU</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ST</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>Test State</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>L</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>Test Locality</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>O</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>Test Organization</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>OU</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>1C CI</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>CN</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>onecci Root CA</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[ v3_ca ]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>basicConstraints</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>critical, CA:TRUE, pathlen:0</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>keyUsage</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>critical, keyCertSign, cRLSign</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>subjectKeyIdentifier</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>hash</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>authorityKeyIdentifier</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>keyid:always,issuer</span>
</span></span></code></pre></div><p>–í—ã–ø—É—Å–∫–∞–µ–º Root CA (—Å—Ä–æ–∫ - 10 –ª–µ—Ç):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>openssl req -x509 -new -nodes -days <span style=color:#ae81ff>3650</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -newkey rsa:4096 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -keyout onecci-root-ca.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -out onecci-root-ca.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -config openssl-root-ca.cnf
</span></span></code></pre></div><p>–§–∞–π–ª—ã Root CA:</p><ul><li><code>onecci-root-ca.crt</code> - –∫–æ—Ä–Ω–µ–≤–æ–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</li><li><code>onecci-root-ca.key</code> - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á Root CA</li></ul><blockquote><p>‚ö†Ô∏è –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á Root CA (onecci-root-ca.key) –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ. –û–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ Kubernetes –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.</p></blockquote><h4 id=—Å–µ—Ä–≤–µ—Ä–Ω—ã–π-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç>–°–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</h4><p>–°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª OpenSSL.
–î–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—ã–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–≥–æ (leaf) —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞.<br>–ü–∞—Ä–∞–º–µ—Ç—Ä <code>CA:FALSE</code> –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Ü–µ–Ω—Ç—Ä–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano openssl.cnf
</span></span></code></pre></div><p>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ <code>openssl.cnf</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[ req ]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default_bits</span>       <span style=color:#f92672>=</span> <span style=color:#e6db74>2048</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>prompt</span>             <span style=color:#f92672>=</span> <span style=color:#e6db74>no</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>default_md</span>         <span style=color:#f92672>=</span> <span style=color:#e6db74>sha256</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>distinguished_name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>dn</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>req_extensions</span>     <span style=color:#f92672>=</span> <span style=color:#e6db74>v3_req</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[ dn ]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>C</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>RU</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>ST</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>Test State</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>L</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>Test Locality</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>O</span>  <span style=color:#f92672>=</span> <span style=color:#e6db74>Test Organization</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>OU</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>1C CI</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>CN</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>*.onecci.lan</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[ v3_req ]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>subjectAltName</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>@alt_names</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[ v3_ext ]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>basicConstraints</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>critical, CA:FALSE</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>subjectAltName</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>@alt_names</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>keyUsage</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>critical, digitalSignature, keyEncipherment</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>extendedKeyUsage</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>serverAuth</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>subjectKeyIdentifier</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>hash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>[ alt_names ]</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## wildcard</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>DNS.1</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>*.onecci.lan</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## –ø–æ –∏–º–µ–Ω–∞–º</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## DNS.1 = portainer.onecci.lan</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## DNS.4 = registry.onecci.lan</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## DNS.4 = gitlab.onecci.lan</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## DNS.2 = jenkins.onecci.lan</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## DNS.3 = sonarqube.onecci.lan</span>
</span></span></code></pre></div><h5 id=—Ä–∞–∑–¥–µ–ª--req->–†–∞–∑–¥–µ–ª <code>[ req ]</code></h5><ul><li><strong>default_bits = 2048</strong> - –¥–ª–∏–Ω–∞ RSA-–∫–ª—é—á–∞. 2048 –±–∏—Ç —è–≤–ª—è–µ—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤—Å–µ–º–∏ –±—Ä–∞—É–∑–µ—Ä–∞–º–∏ –∏ TLS-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏</li><li><strong>prompt = no</strong> - –æ—Ç–∫–ª—é—á–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞. –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</li><li><strong>default_md = sha256</strong> - –∞–ª–≥–æ—Ä–∏—Ç–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞. SHA-256 —è–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º</li><li><strong>distinguished_name = dn</strong> - —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ä–∞–∑–¥–µ–ª <code>[ dn ]</code>, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—É–±—ä–µ–∫—Ç —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</li><li><strong>req_extensions = v3_req</strong> - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ CSR (–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)</li></ul><h5 id=—Ä–∞–∑–¥–µ–ª--dn--distinguished-name>–†–∞–∑–¥–µ–ª <code>[ dn ]</code> (Distinguished Name)</h5><p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–æ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞.</p><ul><li><strong>C</strong> - —Å—Ç—Ä–∞–Ω–∞ (Country).</li><li><strong>ST</strong> - —Ä–µ–≥–∏–æ–Ω / —Å—É–±—ä–µ–∫—Ç (State).</li><li><strong>L</strong> - –≥–æ—Ä–æ–¥ –∏–ª–∏ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (Locality).</li><li><strong>O</strong> - –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è (Organization).</li><li><strong>OU</strong> - –ø–æ–¥—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ (Organizational Unit).</li><li><strong>CN</strong> - Common Name. –í —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö TLS-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö <strong>–Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –∞–¥—Ä–µ—Å–∞</strong>, –æ—Å—Ç–∞–≤–ª–µ–Ω –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏.</li></ul><h5 id=—Ä–∞–∑–¥–µ–ª--v3_ext--x509-—Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è>–†–∞–∑–¥–µ–ª <code>[ v3_ext ]</code> (X.509 —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)</h5><ul><li><strong>basicConstraints</strong> - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–æ–ª–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞: –º–æ–∂–µ—Ç –ª–∏ –æ–Ω –±—ã—Ç—å —Ü–µ–Ω—Ç—Ä–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (CA):<ul><li><code>critical</code> - –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —ç—Ç–æ –ø–æ–ª–µ, –æ–Ω –æ–±—è–∑–∞–Ω –æ—Ç–∫–ª–æ–Ω–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç;</li><li><code>CA:FALSE</code> - —ç—Ç–æ –∫–æ–Ω–µ—á–Ω—ã–π (leaf) —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –Ω–µ –∏–º–µ—é—â–∏–π –ø—Ä–∞–≤–∞ –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ;</li></ul></li><li><strong>subjectAltName = @alt_names</strong> - –∫–ª—é—á–µ–≤–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ (IP –∏–ª–∏ DNS), –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º.</li><li><strong>keyUsage</strong> - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞:<ul><li><code>critical</code> - –µ—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–µ –ø–æ–Ω–∏–º–∞–µ—Ç —ç—Ç–æ –ø–æ–ª–µ, –æ–Ω –æ–±—è–∑–∞–Ω –æ—Ç–∫–ª–æ–Ω–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç;</li><li><code>digitalSignature</code> - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –ø–æ–¥–ø–∏—Å—å –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–ø–∏—Å—å TLS-—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏—è;</li><li><code>keyEncipherment</code> - —Ä–∞–∑—Ä–µ—à–∞–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π –ø—Ä–∏ TLS-—Ä—É–∫–æ–ø–æ–∂–∞—Ç–∏–∏;</li></ul></li><li><strong>extendedKeyUsage = serverAuth</strong> - —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (HTTPS).</li><li><strong>subjectKeyIdentifier = hash</strong> - —É–∫–∞–∑—ã–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ Subject Key Identifier –∫–∞–∫ —Ö–µ—à –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ –∫–ª—é—á–∞ –ø—Ä–∏ –≤—ã–ø—É—Å–∫–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞.</li></ul><h5 id=—Ä–∞–∑–¥–µ–ª--alt_names->–†–∞–∑–¥–µ–ª <code>[ alt_names ]</code></h5><p>–í —Ä–∞–∑–¥–µ–ª–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –∞–¥—Ä–µ—Å–æ–≤ —Å–µ—Ä–≤–∏—Å–æ–≤, –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.</p><p>–î–æ–ø—É—Å—Ç–∏–º—ã –≤–∞—Ä–∏–∞–Ω—Ç—ã:</p><ul><li><strong>DNS.1 = &lt;–∞–¥—Ä–µ—Å-—Å–µ—Ä–≤–∏—Å–∞></strong> - DNS.1, DNS.2 –∏ —Ç.–¥. –∑–∞–ø–∏—Å—å –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–º–µ–Ω–∏.</li><li><strong>DNS.1 = *.onecci.lan</strong> - –≤–∞—Ä–∏–∞–Ω—Ç —Å <strong>wildcard-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º</strong>, –≤–º–µ—Å—Ç–æ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –æ–¥–Ω–æ –∏–º—è —Å–æ –∑–≤–µ–∑–¥–æ—á–∫–æ–π. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –±—É–¥–µ—Ç –≤–∞–ª–∏–¥–µ–Ω –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤</li></ul><p>–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∏ CSR (–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>openssl req -new -nodes <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -newkey rsa:2048 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -keyout tls.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -out tls.csr <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -config openssl.cnf
</span></span></code></pre></div><p>–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º CSR –Ω–∞—à–∏–º Root CA –∏ –ø–æ–ª—É—á–∞–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (leaf) (—Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è - 2 –≥–æ–¥–∞):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>openssl x509 -req -days <span style=color:#ae81ff>730</span> -sha256 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -in tls.csr <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -CA onecci-root-ca.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -CAkey onecci-root-ca.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -CAcreateserial <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -out tls.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -extfile openssl.cnf <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -extensions v3_ext
</span></span></code></pre></div><p>–ü–æ–ª—É—á–∏—Ç—Å—è —Ç—Ä–∏ —Ñ–∞–π–ª–∞:</p><ul><li><code>tls.crt</code> - —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (leaf), –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π Root CA</li><li><code>tls.key</code> - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á</li><li><code>tls.csr</code> - –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø—É—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞, –Ω–æ –≤ Kubernetes –æ–Ω –Ω–µ –Ω—É–∂–µ–Ω.</li></ul><h4 id=–ø—Ä–æ–≤–µ—Ä—è–µ–º-san-–≤-–≥–æ—Ç–æ–≤–æ–º-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ>–ü—Ä–æ–≤–µ—Ä—è–µ–º SAN –≤ –≥–æ—Ç–æ–≤–æ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–µ</h4><p>–ü–æ—Å–ª–µ –≤—ã–ø—É—Å–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>openssl x509 -in tls.crt -noout -text | grep -A1 <span style=color:#e6db74>&#34;Subject Alternative Name&#34;</span>
</span></span></code></pre></div><p>–í –≤—ã–≤–æ–¥–µ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∞–¥—Ä–µ—Å DNS —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ <code>openssl.cnf</code>.</p><h3 id=—É—Å—Ç–∞–Ω–æ–≤–∫–∞-root-ca-–≤-–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ-–Ω–∞-—É–∑–ª–∞—Ö-k3s>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ Root CA –≤ –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –Ω–∞ —É–∑–ª–∞—Ö k3s</h3><p>–ï—Å–ª–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ (–Ω–∞—à —Å–ª—É—á–∞–π), Root CA –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞ –Ω–µ–µ.</p><p>Root CA:</p><ul><li>–æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —É–∑–ª–æ–≤ k3s</li><li>–æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –º–∞—à–∏–Ω (–±—Ä–∞—É–∑–µ—Ä–æ–≤)</li></ul><p>–ö–æ–ø–∏—Ä—É–µ–º Root CA –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º trust store:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp /k3s-1c-ci/tls/onecci-root-ca.crt /usr/local/share/ca-certificates/onecci-root-ca.crt
</span></span><span style=display:flex><span>sudo update-ca-certificates
</span></span></code></pre></div><h3 id=traefik---—É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ-—Ç–∞–π–º–∞—É—Ç—ã-–æ—à–∏–±–∫–∞-504-–Ω–∞-–±–æ–ª—å—à–∏—Ö-–∑–∞–ø—Ä–æ—Å–∞—Ö>Traefik - —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã (–æ—à–∏–±–∫–∞ 504 –Ω–∞ –±–æ–ª—å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö)</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano traefik-timeouts.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>helm.cattle.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HelmChartConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>valuesContent</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    additionalArguments:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - &#34;--entryPoints.websecure.transport.respondingTimeouts.readTimeout=600s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - &#34;--entryPoints.websecure.transport.respondingTimeouts.writeTimeout=600s&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - &#34;--entryPoints.websecure.transport.respondingTimeouts.idleTimeout=600s&#34;</span>
</span></span></code></pre></div><p>–ü—Ä–∏–º–µ–Ω—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f traefik-timeouts.yaml
</span></span><span style=display:flex><span>kubectl -n kube-system rollout restart deploy/traefik
</span></span><span style=display:flex><span>kubectl -n kube-system logs deploy/traefik --tail<span style=color:#f92672>=</span><span style=color:#ae81ff>50</span>
</span></span></code></pre></div><h3 id=–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ-–Ω–∞—Å—Ç—Ä–æ–µ–∫-–ø—Ä–∏-—É—Å—Ç–∞–Ω–æ–≤–∫–µ-—Å–µ—Ä–≤–∏—Å–æ–≤>–û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–µ—Ä–≤–∏—Å–æ–≤</h3><p>–ü–æ –º–µ—Ä–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–æ–≤ –º—ã –±—É–¥–µ–º –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–ø–∏—Å–∞–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∑–¥–µ—Å—å –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–æ –æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –æ–±—â–∏–µ –∫–æ–º–∞–Ω–¥—ã.<br>–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.</p><h4 id=–¥–æ–±–∞–≤–ª—è–µ–º-ca-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç-–∫–ª–∏–µ–Ω—Å—Ç–∫–∏–º-—Å–µ—Ä–≤–∏—Å–∞–º-–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ>–î–æ–±–∞–≤–ª—è–µ–º CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∫–ª–∏–µ–Ω—Å—Ç–∫–∏–º —Å–µ—Ä–≤–∏—Å–∞–º (–æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)</h4><p>–ö–æ—Ä–Ω–µ–≤–æ–π CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ —Å–µ—Ä–≤–∏—Å–∞–º <code>*.onecci.lan</code> –ø–æ HTTPS.</p><p>–ú—ã –±—É–¥–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å <strong>ConfigMap</strong> –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ <strong>namespace</strong>, –≥–¥–µ –µ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç—ã (Jenkins, CI-–∞–≥–µ–Ω—Ç—ã –∏ —Ç.–¥.).</p><p>–û–±—â–∞—è –∫–æ–º–∞–Ω–¥–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫.<br>–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create configmap onecci-root-ca <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --from-file<span style=color:#f92672>=</span>onecci-root-ca.crt<span style=color:#f92672>=</span>/k3s-1c-ci/tls/onecci-root-ca.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n &lt;namespace&gt;
</span></span></code></pre></div><h4 id=—Å–æ–∑–¥–∞–µ–º-kubernetes-tls-secret-–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ>–°–æ–∑–¥–∞–µ–º Kubernetes TLS Secret (–æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)</h4><p>Kubernetes Secret –ø—Ä–∏–≤—è–∑–∞–Ω –∫ namespace. Ingress –º–æ–∂–µ—Ç —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ TLS Secret —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Å–≤–æ–µ–≥–æ namespace.<br>–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –Ω–æ Secret —Å–æ–∑–¥–∞–µ–º –≤ –∫–∞–∂–¥–æ–º –Ω—É–∂–Ω–æ–º namespace.</p><p>–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:</p><ul><li>–µ—Å–ª–∏ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º namespace - Secret –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω;</li><li>‚ö†Ô∏è –µ—Å–ª–∏ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–∑–Ω–µ—Å–µ–Ω—ã –ø–æ —Ä–∞–∑–Ω—ã–º namespace (–Ω–∞–ø—Ä–∏–º–µ—Ä jenkins, sonarqube, registry) - TLS Secret –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –≤ –∫–∞–∂–¥–æ–º —Ç–∞–∫–æ–º namespace.</li></ul><p>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –∫–ª—é—á –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ Kubernetes –≤ –≤–∏–¥–µ TLS Secret.<br>–í Kubernetes –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –¢–û–õ–¨–ö–û —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (leaf) –∏ –µ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á.<br><strong>Root CA</strong> –≤ Kubernetes Secret <strong>–Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è</strong>.</p><p>–£ –Ω–∞—Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É–∂–µ —Ö—Ä–∞–Ω—è—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ:</p><ul><li><code>/k3s-1c-ci/tls/tls.crt</code></li><li><code>/k3s-1c-ci/tls/tls.key</code></li></ul><p>–Ø –∏—Å–ø–æ–ª—å–∑—É—é –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∏–º—è TLS —Å–µ–∫—Ä–µ—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ –∏–º–µ–Ω–∏ –¥–æ–º–µ–Ω–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä <code>onecci.lan.tls</code>. Secret —è–≤–ª—è–µ—Ç—Å—è namespaced-—Ä–µ—Å—É—Ä—Å–æ–º, –ø–æ—ç—Ç–æ–º—É –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –∏–º—è –≤ —Ä–∞–∑–Ω—ã—Ö namespace –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç.</p><p>–ö–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç Secret –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ã–ª –ø–µ—Ä–µ–≤—ã–ø—É—â–µ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç.<br>–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret tls onecci.lan.tls <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --cert<span style=color:#f92672>=</span>/k3s-1c-ci/tls/tls.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --key<span style=color:#f92672>=</span>/k3s-1c-ci/tls/tls.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n &lt;namespace&gt; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><h4 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-ingress-–æ–±—â–µ–µ-–æ–ø–∏—Å–∞–Ω–∏–µ>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Ingress (–æ–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)</h4><p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏–º–µ–Ω–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å Kubernetes-–º–∞–Ω–∏—Ñ–µ—Å—Ç Ingress –≤ –≤–∏–¥–µ –æ–±—ã—á–Ω–æ–≥–æ YAML-—Ñ–∞–π–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä <code>jenkins-ingress.yaml</code>).</p><p>Ingress-–º–∞–Ω–∏—Ñ–µ—Å—Ç —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è Traefik: –ø–æ –∫–∞–∫–æ–º—É –∏–º–µ–Ω–∏ –∏–ª–∏ –ø—É—Ç–∏ –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –≤ –∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å.</p><p>–ü—Ä–∏–º–µ—Ä –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ —Å –¥–æ—Å—Ç—É–ø–æ–º –ø–æ –∏–º–µ–Ω–∏ <code>servicename</code> –∏ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø–æ –ø–æ—Ä—Ç—É <code>8080</code>. :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>&lt;servicename&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>&lt;servicename&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>traefik.ingress.kubernetes.io/router.entrypoints</span>: <span style=color:#ae81ff>websecure</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>traefik.ingress.kubernetes.io/router.tls</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingressClassName</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>onecci.lan.tls</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>&lt;servicename&gt;.onecci.lan</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>host</span>: <span style=color:#ae81ff>&lt;servicename&gt;.onecci.lan</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>&lt;servicename&gt;</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>&lt;8080&gt;</span>
</span></span></code></pre></div><p>–ù–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ.</p><ul><li><strong>metadata.name</strong> - –ò–º—è Ingress-—Ä–µ—Å—É—Ä—Å–∞ –≤–Ω—É—Ç—Ä–∏ namespace. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Kubernetes –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–∞.</li><li><strong>metadata.namespace</strong> - Namespace, –≤ –∫–æ—Ç–æ—Ä–æ–º –¥–µ–π—Å—Ç–≤—É–µ—Ç Ingress. –î–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å namespace —Å–µ—Ä–≤–∏—Å–∞ –∏ TLS Secret.</li><li><strong>spec.tls.secretName</strong> - –ò–º—è Kubernetes Secret —Ç–∏–ø–∞ kubernetes.io/tls, —Å–æ–¥–µ—Ä–∂–∞—â–µ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á. Secret –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç–æ–º –∂–µ namespace, —á—Ç–æ –∏ Ingress.</li><li><strong>spec.tls.hosts</strong> - –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–Ω—ã—Ö –∏–º–µ–Ω (—Ö–æ—Å—Ç–æ–≤), –∫ –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–π TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –∏ –∫–ª—é—á, —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è –≤ —Å–≤—è–∑–∞–Ω–Ω–æ–º —Å–µ–∫—Ä–µ—Ç–µ (secretName).</li><li><strong>spec.rules.host</strong> - –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É Traefik –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –¥–æ–ª–∂–Ω–æ —Ä–µ–∑–æ–ª–≤–∏—Ç—å—Å—è –≤ IP –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã (—á–µ—Ä–µ–∑ DNS –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ), –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ SAN —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–∏–ª–∏ –±—ã—Ç—å –ø–æ–∫—Ä—ã—Ç–æ wildcard-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º).</li><li><strong>spec.rules.http.paths.path</strong> - URL-–ø—É—Ç—å, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –¥–µ–π—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏. / –æ–∑–Ω–∞—á–∞–µ—Ç –≤–µ—Å—å —Å–∞–π—Ç.</li><li><strong>spec.rules.http.paths.pathType: Prefix</strong> - –û–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –ø—É—Ç—è–º, –Ω–∞—á–∏–Ω–∞—é—â–∏–º—Å—è —Å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞.</li><li><strong>backend.service.name</strong> - –ò–º—è Kubernetes Service, –≤ –∫–æ—Ç–æ—Ä—ã–π Traefik –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å.</li><li><strong>backend.service.port.number</strong> - –ü–æ—Ä—Ç Service, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç—Ä–∞—Ñ–∏–∫ (–æ–±—ã—á–Ω–æ HTTP-–ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞).</li></ul><h2 id=—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π</h2><h3 id=-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-portainer>üèóÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Portainer</h3><p><em>–§–∞–π–ª &lsquo;04-01-install-portainer.md&rsquo; –Ω–µ –Ω–∞–π–¥–µ–Ω.</em></p><h3 id=-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-docker-registry>üê≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Registry</h3><p><em>–§–∞–π–ª &lsquo;04-02-install-registry.md&rsquo; –Ω–µ –Ω–∞–π–¥–µ–Ω.</em></p><h3 id=-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-gitlab>ü¶ä –£—Å—Ç–∞–Ω–æ–≤–∫–∞ GitLab</h3><h3 id=–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-2>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</h3><p>–°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /k3s-1c-ci/gitlab
</span></span><span style=display:flex><span>cd /k3s-1c-ci/gitlab
</span></span></code></pre></div><h3 id=—Å–æ–∑–¥–∞–µ–º-namespace>–°–æ–∑–¥–∞–µ–º namespace</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace gitlab --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><h3 id=tls-secret-–∏–∑-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞>TLS Secret –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h3><p>–ö–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç Secret –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ã–ª –ø–µ—Ä–µ–≤—ã–ø—É—â–µ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret tls onecci.lan.tls <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --cert<span style=color:#f92672>=</span>/k3s-1c-ci/tls/tls.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --key<span style=color:#f92672>=</span>/k3s-1c-ci/tls/tls.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n gitlab <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get secret onecci.lan.tls -n gitlab
</span></span></code></pre></div><h3 id=—Ñ–∏–∫—Å–∏—Ä—É–µ–º-ssh-host-keys-–∫–∞–∫-kubernetes-secrets>–§–∏–∫—Å–∏—Ä—É–µ–º SSH host keys –∫–∞–∫ Kubernetes Secrets</h3><p>–≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø—Ä–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–∏ –ø–æ–¥–æ–≤ SSH fingerprint GitLab –Ω–µ –º–µ–Ω—è–ª—Å—è (–∏–Ω–∞—á–µ –∫–ª–∏–µ–Ω—Ç—ã –±—É–¥—É—Ç —Ä—É–≥–∞—Ç—å—Å—è –Ω–∞ MITM)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p hostKeys
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa     -f hostKeys/ssh_host_rsa_key     -N <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>ssh-keygen -t ecdsa   -f hostKeys/ssh_host_ecdsa_key   -N <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>ssh-keygen -t ed25519 -f hostKeys/ssh_host_ed25519_key -N <span style=color:#e6db74>&#34;&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n gitlab create secret generic gitlab-gitlab-shell-host-keys <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --from-file hostKeys <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><h3 id=–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º-traefik-–¥–ª—è-ssh-tcp-–ø–æ—Ä—Ç–∞-gitlab>–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Traefik –¥–ª—è SSH (TCP) –ø–æ—Ä—Ç–∞ GitLab</h3><p>Traefik –Ω—É–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç –¥–ª—è GitLab Shell (SSH daemon). –ù–∞ —Ä–µ–∞–ª—å–Ω–æ–º —É–∑–ª–µ k3s –ø–æ—Ä—Ç 22 –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–Ω—è—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–º SSH, –ø–æ—ç—Ç–æ–º—É –¥–µ–ª–∞–µ–º –ø–æ—Ä—Ç 2222.</p><h4 id=–¥–æ–±–∞–≤–ª—è–µ–º-helmchartconfig-–¥–ª—è-traefik-–≤-k3s>–î–æ–±–∞–≤–ª—è–µ–º HelmChartConfig –¥–ª—è Traefik –≤ k3s</h4><p>–í k3s –ª—é–±–æ–π –º–∞–Ω–∏—Ñ–µ—Å—Ç –≤ <code>/var/lib/rancher/k3s/server/manifests</code> –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è.</p><p>–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nano /var/lib/rancher/k3s/server/manifests/traefik-config-gitlab-ssh.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>helm.cattle.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>HelmChartConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>kube-system</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>valuesContent</span>: |-<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    ports:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      gitlab-shell:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        expose:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            default: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        port: 2222
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        exposedPort: 2222
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        protocol: TCP</span>
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ Traefik –ø—Ä–∏–º–µ–Ω–∏–ª –∫–æ–Ω—Ñ–∏–≥:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n kube-system get pods -l app.kubernetes.io/name<span style=color:#f92672>=</span>traefik
</span></span><span style=display:flex><span>kubectl -n kube-system get svc traefik
</span></span></code></pre></div><p>–í –∫–æ–ª–æ–Ω–∫–µ <code>POT(S)</code> –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –ø–æ—Ä—Ç <code>2222</code>.</p><h4 id=—Å–æ–∑–¥–∞–µ–º-ingressroutetcp-–¥–ª—è-gitlab-ssh>–°–æ–∑–¥–∞–µ–º IngressRouteTCP –¥–ª—è GitLab SSH</h4><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä—É–ø–ø—É CRD –¥–ª—è apiVersion.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get crd | grep -i ingressroutetcp
</span></span></code></pre></div><ul><li>ingressroutetcps.traefik.io - apiVersion: traefik.io/v1alpha1</li><li>ingressroutetcps.traefik.containo.us - apiVersion: traefik.containo.us/v1alpha1</li></ul><p>–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano gitlab-ssh-ingressroutetcp.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>traefik.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>IngressRouteTCP</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>gitlab-ssh</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>gitlab</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>entryPoints</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>gitlab-shell</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>routes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>match</span>: <span style=color:#ae81ff>HostSNI(`*`)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>gitlab-gitlab-shell</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2222</span>
</span></span></code></pre></div><p>–ü—Ä–∏–º–µ–Ω—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f gitlab-ssh-ingressroutetcp.yaml
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n gitlab get ingressroutetcp
</span></span><span style=display:flex><span>kubectl -n gitlab describe ingressroutetcp gitlab-ssh
</span></span></code></pre></div><h3 id=–≥–æ—Ç–æ–≤–∏–º-valuesyaml-–¥–ª—è-gitlab-helm-chart>–ì–æ—Ç–æ–≤–∏–º values.yaml –¥–ª—è GitLab Helm Chart</h3><p>–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano gitlab-values.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>global</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>edition</span>: <span style=color:#ae81ff>ce</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>domain</span>: <span style=color:#ae81ff>onecci.lan</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>https</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>class</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>onecci.lan.tls</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>configureCertmanager</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>shell</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>2222</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>registry</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>gitlab</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>webservice</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1.5Gi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>sidekiq</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;1Gi&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;500m&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>minReplicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>maxReplicas</span>: <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>gitlab-runner</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>install</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>nginx-ingress</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>registry</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>installCertmanager</span>: <span style=color:#66d9ef>false</span>
</span></span></code></pre></div><p>–ù–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ</p><ul><li><strong>global.edition: ce</strong> - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å community edition</li><li><strong>global.hosts.domain</strong> - –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –¥–æ–º–µ–Ω</li><li><strong>global.ingress.class: traefik</strong> - gitlab –º–æ–∂–µ—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å nginx-ingress</li><li><strong>global.ingress.tls.secretName</strong> - —Ä–∞–Ω–µ–µ –º—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏ tls —Å–µ–∫—Ä–µ—Ç, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π <code>kubectl get secret -n &lt;namespace></code></li><li><strong>global.ingress.configureCertmanager: false</strong> - –Ω–µ –ø—ã—Ç–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ —á—Ç–æ –µ—Å—Ç—å.</li><li><strong>global.shell.port</strong> - —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç ssh –ø–æ—Ä—Ç (–º—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª–∏ 2222)</li><li><strong>global.registry.enabled: true</strong> - –≤–∫–ª—é—á–∞–µ—Ç GitLab Container Registry</li><li><strong>gitlab.webservice.resources.requests</strong> - (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–æ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞. –ü–æ-—É–º–æ–ª—á–∞–Ω–∏—é webservice –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –¥–≤—É—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö –∏ –ø—Ä–æ—Å–∏—Ç –ø–æ 2,5 –≥–∏–≥–∞–±–∞–π—Ç –æ–ø–µ—Ä–∞—Ç–∏–≤–∫–∏. –†–∞—Å—Ç–æ—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è —Ö–æ—É–º–ª–∞–±–∞.</li><li><strong>gitlab.webservice.minReplicas/maxReplicas</strong> - (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—É—Å–∫–∞–µ–º—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤. –î–ª—è —Ö–æ—É–º–ª–∞–±–∞ —Å—Ç–∞–≤–∏–º 1 (–ø–æ-—É–º–ø–æ–ª—á–∞–Ω–∏—é 2).</li><li><strong>gitlab.sidekiq.resources.requests</strong> - (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ sidekiq - –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ—Å—É—Ä—Å–æ–≤. –ü–æ-—É–º–æ–ª—á–∞–Ω–∏—é sidekiq –ø—Ä–æ—Å–∏—Ç –ø–æ 2 –≥–∏–≥–∞–±–∞–π—Ç–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–∫–∏.</li><li><strong>gitlab-runner.install: false</strong> - –≤–æ-–ø–µ—Ä–≤—ã—Ö –º—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å jenkins, –≤–æ-–≤—Ç–æ—Ä—ã—Ö –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–Ω–Ω–µ—Ä–∞ –Ω—É–∂–µ–Ω —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–º gitlab.</li><li><strong>nginx-ingress.enabled: false</strong> - –æ—Ç–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç nginx</li><li><strong>installCertmanager: false</strong> - –æ—Ç–∫–ª—é—á–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç cert-manager</li></ul><h3 id=—É—Å—Ç–∞–Ω–æ–≤–∫–∞-gitlab-—á–µ—Ä–µ–∑-helm>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ GitLab —á–µ—Ä–µ–∑ Helm</h3><p>–î–æ–±–∞–≤–ª—è–µ–º Helm-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π gitlab</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add gitlab https://charts.gitlab.io
</span></span><span style=display:flex><span>helm repo update
</span></span></code></pre></div><p>–í—ã–ø–æ–ª–Ω—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrade --install gitlab gitlab/gitlab <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --namespace gitlab <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -f gitlab-values.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --timeout 20m
</span></span></code></pre></div><blockquote><p>–ó–¥–µ—Å—å –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>Error: Kubernetes cluster unreachable: Get <span style=color:#e6db74>&#34;http://localhost:8080/version&#34;</span>: dial tcp 127.0.0.1:8080: connect: connection refused
</span></span></code></pre></div><p>–≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ Helm –Ω–µ –≤–∏–¥–∏—Ç kubeconfig, –ø–æ—ç—Ç–æ–º—É –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ ‚Äú–∫–ª–∞—Å—Ç–µ—Ä—É –ø–æ >—É–º–æ–ª—á–∞–Ω–∏—é‚Äù localhost:8080
–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Ä–µ—à–µ–Ω–∏—è —É–∫–∞–∑–∞—Ç—å kubeconfig k3s:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>export KUBECONFIG<span style=color:#f92672>=</span>/etc/rancher/k3s/k3s.yaml
</span></span><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><p>–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏.</p></blockquote><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm -n gitlab status gitlab
</span></span><span style=display:flex><span>kubectl -n gitlab get pods -o wide
</span></span><span style=display:flex><span>kubectl -n gitlab get ingress
</span></span></code></pre></div><h3 id=–ø–µ—Ä–≤—ã–π-–≤—Ö–æ–¥-–≤-gitlab>–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –≤ GitLab</h3><p>URL (–≤ –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ) - <code>https://gitlab.onecci.lan</code></p><p>–õ–æ–≥–∏–Ω: <code>root</code></p><p>–ó–∞–¥–∞–µ–º –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ toolbox:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n gitlab exec -it $TOOLBOX_POD -- gitlab-rails runner <span style=color:#e6db74>&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>u = User.find_by_username(&#39;root&#39;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>u.password = &#39;NewStrongPass123!&#39;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>u.password_confirmation = &#39;NewStrongPass123!&#39;;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>if u.save
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  puts &#39;SUCCESS: Password changed&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>else
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  puts &#39;ERROR: &#39; + u.errors.full_messages.join(&#39;, &#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>end&#34;</span>
</span></span></code></pre></div><h3 id=–ø—Ä–æ–≤–µ—Ä—è–µ–º-git-clone-–ø–æ-https-–∏-ssh>–ü—Ä–æ–≤–µ—Ä—è–µ–º Git clone –ø–æ HTTPS –∏ SSH</h3><h4 id=https>HTTPS</h4><p>–í GitLab —Å–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://gitlab.onecci.lan/&lt;group&gt;/&lt;project&gt;.git
</span></span></code></pre></div><h4 id=ssh-–ø–æ—Ä—Ç-2222>SSH (–ø–æ—Ä—Ç 2222)</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone ssh://git@gitlab.onecci.lan:2222/&lt;group&gt;/&lt;project&gt;.git
</span></span></code></pre></div><p>–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥–ª–∏ –¥–µ–ª–∞—Ç—å <code>git@gitlab.onecci.lan:&lt;group>/&lt;project>.git</code> –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø–æ—Ä—Ç–∞, —Ç–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ø–æ—Ä—Ç 22 –Ω–∞ —É–∑–ª–µ –∏–ª–∏ –≤—ã–Ω–æ—Å–∏—Ç—å GitLab SSH –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π IP.</p><h4 id=–æ—à–∏–±–∫–∞-ssl-certificate-problem-unable-to-get-local-issuer-certificate>–û—à–∏–±–∫–∞ SSL certificate problem: unable to get local issuer certificate</h4><h2 id=–æ—à–∏–±–∫–∞-ssl-certificate-problem-unable-to-get-local-issuer-certificate-1>–û—à–∏–±–∫–∞ SSL certificate problem: unable to get local issuer certificate</h2><p>–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–∑ GitLab (—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–≥–æ –≤ k3s —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-text data-lang=text><span style=display:flex><span>SSL certificate problem: unable to get local issuer certificate
</span></span></code></pre></div><p>Git –Ω–µ –¥–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä–Ω–µ–≤–æ–º—É —Ü–µ–Ω—Ç—Ä—É —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (Root CA), –∫–æ—Ç–æ—Ä—ã–º –ø–æ–¥–ø–∏—Å–∞–Ω TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç GitLab.</p><p>–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å root CA –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ.
–ï—Å–ª–∏ –ø–æ –∫–∞–∫–æ–π-—Ç–æ –ø—Ä–∏—á–∏–Ω–µ –¥–µ–ª–∞—Ç—å —ç—Ç–æ–≥–æ –Ω–µ —Ö–æ—á–µ—Ç—Å—è, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π git.</p><p>–î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</p><ul><li>–ò–º—è —Ñ–∞–π–ª–∞: <code>onecci-root-ca.crt</code></li><li>–¢–∏–ø: Root CA</li><li>–§–æ—Ä–º–∞—Ç: PEM
(–¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å <code>-----BEGIN CERTIFICATE-----</code>)</li></ul><h3 id=linux-ubuntu>Linux (Ubuntu)</h3><p>–°–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è CA Git</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/.config/git/certs
</span></span></code></pre></div><p>–ö–æ–ø–∏—Ä—É–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –≤ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cp onecci-root-ca.crt ~/.config/git/certs/
</span></span></code></pre></div><p>–ò—Ç–æ–≥–æ–≤—ã–π –ø—É—Ç—å:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>~/.config/git/certs/onecci-root-ca.crt
</span></span></code></pre></div><p>–£–∫–∞–∑—ã–≤–∞–µ–º Git –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç CA (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—à–µ–≥–æ GitLab)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git config --global http.<span style=color:#e6db74>&#34;https://gitlab.onecci.lan&#34;</span>.sslCAInfo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;~/.config/git/certs/onecci-root-ca.crt&#34;</span>
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git ls-remote https://gitlab.onecci.lan/&lt;group&gt;/&lt;repo&gt;.git
</span></span></code></pre></div><p>–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</p><h3 id=windows-git-for-windows>Windows (Git for Windows)</h3><p>–°–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø—É—Ç—å (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\&lt;</span>USERNAME&gt;<span style=color:#ae81ff>\.</span>git-certs<span style=color:#ae81ff>\
</span></span></span></code></pre></div><p>–ü—Ä–∏–º–µ—Ä</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\S</span>ergey<span style=color:#ae81ff>\.</span>git-certs<span style=color:#ae81ff>\
</span></span></span></code></pre></div><p>–ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –≤ —Å–æ–∑–¥–∞–Ω–Ω—É—é –ø–∞–ø–ø–∫—É –∏ –ø–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π –∏—Ç–æ–≥–æ–≤—ã–π –ø—É—Ç—å</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>C:<span style=color:#ae81ff>\U</span>sers<span style=color:#ae81ff>\S</span>ergey<span style=color:#ae81ff>\.</span>git-certs<span style=color:#ae81ff>\o</span>necci-root-ca.crt
</span></span></code></pre></div><p>–ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º Git –Ω–∞ OpenSSL backend
Git for Windows –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Windows certificate store (<code>schannel</code>), –∫–æ—Ç–æ—Ä—ã–π <strong>–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç <code>sslCAInfo</code></strong>.</p><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git config --global --get http.sslBackend
</span></span></code></pre></div><p>–ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ <code>schannel</code> –∏–ª–∏ –ø—É—Å—Ç–æ - –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—É:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git config --global http.sslBackend openssl
</span></span></code></pre></div><p>–£–∫–∞–∑—ã–≤–∞–µ–º Git –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç CA (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–∞—à–µ–≥–æ GitLab)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git config --global http.<span style=color:#e6db74>&#34;https://gitlab.onecci.lan&#34;</span>.sslCAInfo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;C:/Users/Sergey/.git-certs/onecci-root-ca.crt&#34;</span>
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git ls-remote https://gitlab.onecci.lan/&lt;group&gt;/&lt;repo&gt;.git
</span></span></code></pre></div><p>–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –Ω–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.</p><h3 id=-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-sonarqube>üõú –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SonarQube</h3><h3 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Ö–æ—Å—Ç–∞>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ö–æ—Å—Ç–∞</h3><p>–ü—Ä–µ–∂–¥–µ —á–µ–º –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ SonarQube, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ö–æ—Å—Ç.
–í–Ω—É—Ç—Ä–∏ SonarQube –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Elasticsearch, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥—ä—è–≤–ª—è–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º —è–¥—Ä–∞ Linux –∏ –ª–∏–º–∏—Ç–∞–º (–∫–æ–ª-–≤–æ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤, —á–∏—Å–ª–æ –ø–æ—Ç–æ–∫–æ–≤).</p><h4 id=vmmax_map_count>vm.max_map_count</h4><p>–£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ª–∏–º–∏—Ç memory mappings –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. Elasticsearch –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç mmap, –∏ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ SonarQube –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo sysctl -w vm.max_map_count<span style=color:#f92672>=</span><span style=color:#ae81ff>262144</span>
</span></span><span style=display:flex><span>sudo tee /etc/sysctl.d/99-sonarqube.conf &gt;/dev/null <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>vm.max_map_count=262144
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>sudo sysctl --system
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl vm.max_map_count
</span></span></code></pre></div><h4 id=fsfile-max>fs.file-max</h4><p>–£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±—â–∏–π –ª–∏–º–∏—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Å–∏—Å—Ç–µ–º–µ. SonarQube –Ω–∞ –ø–∞—Ä—É —Å Elasticsearch –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –º–Ω–æ–≥–æ —Ñ–∞–π–ª–æ–≤ (–∏–Ω–¥–µ–∫—Å—ã, —Å–µ–≥–º–µ–Ω—Ç—ã, –ª–æ–≥–∏).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo tee -a /etc/sysctl.d/99-sonarqube.conf &gt;/dev/null <span style=color:#e6db74>&lt;&lt;&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>fs.file-max=65536
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOF</span>
</span></span><span style=display:flex><span>sudo sysctl --system
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sysctl fs.file-max
</span></span></code></pre></div><h3 id=–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-3>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</h3><p>–°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –ø–æ–¥ –∫–æ–Ω—Ñ–∏–≥–∏ SonarQube.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /k3s-1c-ci/sonarqube
</span></span><span style=display:flex><span>cd /k3s-1c-ci/sonarqube
</span></span></code></pre></div><h3 id=—Å–æ–∑–¥–∞–µ–º-namespace-1>–°–æ–∑–¥–∞–µ–º namespace</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace sonarqube --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><h3 id=tls-secret-–∏–∑-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞-1>TLS Secret –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h3><p>–ö–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç Secret –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ã–ª –ø–µ—Ä–µ–≤—ã–ø—É—â–µ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret tls onecci.lan.tls <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --cert<span style=color:#f92672>=</span>/k3s-1c-ci/tls/tls.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --key<span style=color:#f92672>=</span>/k3s-1c-ci/tls/tls.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n sonarqube <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get secret onecci.lan.tls -n sonarqube
</span></span></code></pre></div><h3 id=secret-monitoring-passcode>Secret Monitoring passcode</h3><p><code>monitoringPasscode</code> - —ç—Ç–æ —Å–ª—É–∂–µ–±–Ω—ã–π –ø–∞—Ä–æ–ª—å SonarQube, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–º—É endpoint <code>/api/monitoring/metrics</code>.</p><ul><li>—ç—Ç–æ <strong>–Ω–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</strong> SonarQube;</li><li>–æ–Ω <strong>–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≤—Ö–æ–¥–∞ –≤ UI</strong>;</li><li>–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å –∏–ª–∏ –≤–≤–æ–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.</li></ul><p>–í–º–µ—Å—Ç–æ <code>NewStrongPass123!</code> –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n sonarqube create secret generic sonarqube-monitoring-passcode <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --from-literal<span style=color:#f92672>=</span>passcode<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;NewStrongPass123!&#39;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><h3 id=—Å–æ–∑–¥–∞–µ–º-valuesyaml-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∏>–°–æ–∑–¥–∞–µ–º values.yaml (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏)</h3><p>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º –ø–ª–∞–≥–∏–Ω <code>sonarqube-community-branch-plugin</code>, –≤–µ—Ä—Å–∏–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã—Ö–æ–¥—è—Ç —Å –∑–∞–¥—Ä–µ—Ä–∂–Ω–æ–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å–∞–º–æ–≥–æ SonarQube. –ü–æ—ç—Ç–æ–º—É –º—ã —Å—Ç–∞–≤–∏–º –Ω–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é SonarQube, –∞ —Ç—É –≤–µ—Ä—Å–∏—é, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–π –ø–æ–¥—Ö–æ–¥–∏—Ç –ø–ª–∞–≥–∏–Ω. –î–∞–ª–µ–µ –≤ <code>yaml</code> –±–ª–æ–∫–∏ –¥–ª—è –ø–ª–∞–≥–∏–Ω–∞ –æ—Ç–º–µ—á–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏.</p><p>–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano sonarqube-values.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>community</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## –§–∏–∫—Å–∏—Ä—É–µ–º –≤–µ—Ä—Å–∏—é SonarQube –ø–æ–¥ branch-plugin</span>
</span></span><span style=display:flex><span><span style=color:#f92672>image</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>repository</span>: <span style=color:#ae81ff>sonarqube</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tag</span>: <span style=color:#ae81ff>25.9.0.112764</span>-<span style=color:#ae81ff>community</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>pullPolicy</span>: <span style=color:#ae81ff>IfNotPresent</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>persistence</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClass</span>: <span style=color:#e6db74>&#34;local-path&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>size</span>: <span style=color:#ae81ff>10Gi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>postgresql</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>persistence</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>storageClass</span>: <span style=color:#e6db74>&#34;local-path&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>size</span>: <span style=color:#ae81ff>20Gi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>requests</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;2Gi&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>limits</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>cpu</span>: <span style=color:#e6db74>&#34;2&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>memory</span>: <span style=color:#e6db74>&#34;8Gi&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>monitoringPasscodeSecretName</span>: <span style=color:#ae81ff>sonarqube-monitoring-passcode</span>
</span></span><span style=display:flex><span><span style=color:#f92672>monitoringPasscodeSecretKey</span>: <span style=color:#ae81ff>passcode</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>initSysctl</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span><span style=color:#f92672>initFs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>ingress</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ingressClassName</span>: <span style=color:#ae81ff>traefik</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>traefik.ingress.kubernetes.io/router.entrypoints</span>: <span style=color:#ae81ff>websecure</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sonarqube.onecci.lan</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>tls</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>secretName</span>: <span style=color:#ae81ff>onecci.lan.tls</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## –ú–µ—Ö–∞–Ω–∏–∑–º Helm Chart –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≥–∏–Ω–æ–≤</span>
</span></span><span style=display:flex><span><span style=color:#f92672>plugins</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>install</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># –ü–ª–∞–≥–∏–Ω 1–° (BSL)</span>
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#34;https://github.com/1c-syntax/sonar-bsl-plugin-community/releases/download/v1.16.1/sonar-communitybsl-plugin-1.16.1.jar&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Community Branch Plugin</span>
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#34;https://github.com/mc1arke/sonarqube-community-branch-plugin/releases/download/25.9.0/sonarqube-community-branch-plugin-25.9.0.jar&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>sonarProperties</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–º—è—Ç–∏ –∏ branch –ø–ª–∞–≥–∏–Ω–∞ –¥–ª—è Web-–ø—Ä–æ—Ü–µ—Å—Å–∞</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sonar.web.javaAdditionalOpts</span>: <span style=color:#e6db74>&#34;-Xms1024m -Xmx2048m -javaagent:/opt/sonarqube/extensions/plugins/sonarqube-community-branch-plugin-25.9.0.jar=web&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–º—è—Ç–∏ –∏ branch –ø–ª–∞–≥–∏–Ω–∞ –¥–ª—è Compute Engine (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞–Ω–∞–ª–∏–∑–æ–≤)</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sonar.ce.javaAdditionalOpts</span>:  <span style=color:#e6db74>&#34;-Xms1024m -Xmx2048m -javaagent:/opt/sonarqube/extensions/plugins/sonarqube-community-branch-plugin-25.9.0.jar=ce&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–º—è—Ç–∏ Java</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sonar.search.javaAdditionalOpts</span>: <span style=color:#e6db74>&#34;-Xms2048m -Xmx2048m&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã UI (–≤–µ—Ç–∫–∏ / PR) –ø–ª–∞–≥–∏–Ω –∑–∞–º–µ–Ω—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π webapp SonarQube.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## –≠—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –Ω–∞—Å—Ç—Ä–æ–µ–∫:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## - emptyDir volume</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## - initContainer, –∫–æ—Ç–æ—Ä—ã–π —Å–∫–∞—á–∏–≤–∞–µ—Ç sonarqube-webapp.zip</span>
</span></span><span style=display:flex><span><span style=color:#75715e>## - –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ /opt/sonarqube/web</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>extraVolumes</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>webapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>emptyDir</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>sizeLimit</span>: <span style=color:#ae81ff>50Mi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>extraVolumeMounts</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>webapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/opt/sonarqube/web</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>extraInitContainers</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>download-community-branch-webapp</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>busybox:1.37</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>webapp</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/web</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>sh</span>
</span></span><span style=display:flex><span>      - -<span style=color:#ae81ff>c</span>
</span></span><span style=display:flex><span>      - &gt;<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        wget -O /tmp/sonarqube-webapp.zip
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        https://github.com/mc1arke/sonarqube-community-branch-plugin/releases/download/25.9.0/sonarqube-webapp.zip &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        unzip -o /tmp/sonarqube-webapp.zip -d /web &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        chmod -R 755 /web &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        chown -R 1000:0 /web &amp;&amp;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        rm -f /tmp/sonarqube-webapp.zip</span>
</span></span></code></pre></div><h4 id=–Ω–∞-—á—Ç–æ-–æ–±—Ä–∞—Ç–∏—Ç—å-–≤–Ω–∏–º–∞–Ω–∏–µ-–≤-valuesyaml>–ù–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –≤ values.yaml</h4><ul><li><code>community.enabled: true</code> - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ñ–ª–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Community Build.</li><li><code>persistence.enabled</code> - –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ç–æ–º–∞ (PVC) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–ª–∞–≥–∏–Ω–æ–≤ –∏ –∏–Ω–¥–µ–∫—Å–æ–≤ Elasticsearch. –ë–µ–∑ —ç—Ç–æ–≥–æ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∞ SonarQube –Ω–∞—á–Ω–µ—Ç –¥–æ–ª–≥—É—é –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é.</li><li><code>postgresql.enabled</code> - —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ PostgreSQL.</li><li><code>resources.limits.memory</code> - –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º.</li><li><code>monitoringPasscodeSecretName/Key</code> - –ø–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ API SonarQube –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.</li><li><code>initSysctl.enabled</code> –∏ <code>initFs.enabled</code> - –∑–∞–ø—É—Å–∫ Pod –≤ Restricted (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö) –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞—Ö –∏–º–µ–Ω –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (Root/Privileged).</li><li><code>ingress.*</code> - Traefik Ingress. –î–ª—è k3s —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ –¥–æ–º–µ–Ω–Ω–æ–º—É –∏–º–µ–Ω–∏.</li><li><code>tls.secretName</code> - –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–¥–∏–Ω—ã–π wildcard secret <code>onecci.lan.tls</code>.</li><li><code>plugins.install</code> - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞–≥–∏–Ω–æ–≤ –≤ Kubernetes —á–µ—Ä–µ–∑ Helm.</li><li><code>extraEnv / SONAR_*_JAVAOPTS</code> - —Ç–æ—á–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞–º—è—Ç–∏ Java. –î–ª—è –±–æ–ª—å—à–∏—Ö –∞–Ω–∞–ª–∏–∑–æ–≤ 1–° —á–∞—â–µ –≤—Å–µ–≥–æ —É–ø–∏—Ä–∞–µ—à—å—Å—è –≤ CE –∏ Search.</li></ul><h3 id=—É—Å—Ç–∞–Ω–æ–≤–∫–∞-sonarsource-—á–µ—Ä–µ–∑-helm>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ SonarSource —á–µ—Ä–µ–∑ Helm</h3><p>–ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Helm-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π SonarSource.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add sonarqube https://SonarSource.github.io/helm-chart-sonarqube
</span></span><span style=display:flex><span>helm repo update
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm search repo sonarqube/sonarqube
</span></span></code></pre></div><p>–í—ã–ø–æ–ª–Ω—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–∫—É</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrade --install sonarqube sonarqube/sonarqube <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --namespace sonarqube <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -f sonarqube-values.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --timeout 20m
</span></span></code></pre></div><blockquote><p>–ó–¥–µ—Å—å –º–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—å—Å—è –æ—à–∏–±–∫–∞</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>Error: Kubernetes cluster unreachable: Get <span style=color:#e6db74>&#34;http://localhost:8080/version&#34;</span>: dial tcp 127.0.0.1:8080: connect: connection refused
</span></span></code></pre></div><p>–≠—Ç–∞ –æ—à–∏–±–∫–∞ –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ Helm –Ω–µ –≤–∏–¥–∏—Ç kubeconfig, –ø–æ—ç—Ç–æ–º—É –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ ‚Äú–∫–ª–∞—Å—Ç–µ—Ä—É –ø–æ >—É–º–æ–ª—á–∞–Ω–∏—é‚Äù localhost:8080
–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± —Ä–µ—à–µ–Ω–∏—è —É–∫–∞–∑–∞—Ç—å kubeconfig k3s:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>export KUBECONFIG<span style=color:#f92672>=</span>/etc/rancher/k3s/k3s.yaml
</span></span><span style=display:flex><span>kubectl get nodes
</span></span></code></pre></div><p>–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–ø—ã—Ç–∫—É —É—Å—Ç–∞–Ω–æ–≤–∫–∏.</p></blockquote><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm -n sonarqube status sonarqube
</span></span><span style=display:flex><span>kubectl -n sonarqube get pods -o wide
</span></span><span style=display:flex><span>kubectl -n sonarqube get ingress
</span></span></code></pre></div><h3 id=–ø–µ—Ä–≤—ã–π-–≤—Ö–æ–¥-–∏-–ø–∞—Ä–æ–ª–∏>–ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ –∏ –ø–∞—Ä–æ–ª–∏</h3><p>–û—Ç–∫—Ä—ã–≤–∞–µ–º URL:</p><ul><li><a class=link href=https://sonarqube.onecci.lan target=_blank rel=noopener>https://sonarqube.onecci.lan</a></li></ul><p>–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: <code>admin / admin</code>. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ SonarQube –ø–æ–ø—Ä–æ—Å–∏—Ç —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å.</p><h3 id=–ø—Ä–æ–≤–µ—Ä–∫–∏-–ø–æ—Å–ª–µ-—É—Å—Ç–∞–Ω–æ–≤–∫–∏>–ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏</h3><p>–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å—ã SonarQube –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ Elasticsearch –ø–æ–ª—É—á–∏–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ª–∏–º–∏—Ç—ã.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n sonarqube exec -it deploy/sonarqube -- sh -lc <span style=color:#e6db74>&#39;ulimit -n &amp;&amp; ulimit -u&#39;</span>
</span></span></code></pre></div><p>–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</p><ul><li>nofile ‚â• 131072</li><li>nproc ‚â• 8192</li></ul><p>–ß—Ç–æ –¥–µ–ª–∞—Ç—å, e—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤—Ä–æ–¥–µ <code>4096</code> / <code>1024</code> –∏ –≤ –ª–æ–≥–∞—Ö –µ—Å—Ç—å –æ—à–∏–±–∫–∏ Elasticsearch (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code>max file descriptors [4096] too low</code>).<br>–ü–æ–¥–Ω–∏–º–∞–µ–º –ª–∏–º–∏—Ç—ã –Ω–∞ —Ö–æ—Å—Ç–µ.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl edit k3s
</span></span></code></pre></div><p>–£–∫–∞–∑—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#66d9ef>[Service]</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>LimitNOFILE</span><span style=color:#f92672>=</span><span style=color:#e6db74>131072</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>LimitNPROC</span><span style=color:#f92672>=</span><span style=color:#e6db74>8192</span>
</span></span></code></pre></div><p>–ü—Ä–∏–º–µ–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl daemon-reexec
</span></span><span style=display:flex><span>sudo systemctl restart k3s
</span></span></code></pre></div><p>–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ pod SonarQube —Å–Ω–æ–≤–∞ —Å—Ç–∞–Ω–µ—Ç Running, –ø–æ–≤—Ç–æ—Ä—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n sonarqube exec -it deploy/sonarqube -- sh -lc <span style=color:#e6db74>&#39;ulimit -n &amp;&amp; ulimit -u&#39;</span>
</span></span></code></pre></div><h3 id=-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-jenkins>ü•∏ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Jenkins</h3><p>–í Kubernetes –º—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Jenkins –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º Helm-—á–∞—Ä—Ç–æ–º <code>jenkinsci/jenkins</code>.</p><p>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</p><ul><li>Jenkins - Installing on Kubernetes - Install Jenkins with Helm v3: <a class=link href=https://www.jenkins.io/doc/book/installing/kubernetes/#install-jenkins-with-helm-v3 target=_blank rel=noopener>https://www.jenkins.io/doc/book/installing/kubernetes/#install-jenkins-with-helm-v3</a></li><li>Jenkins Helm chart (values.yaml): <a class=link href=https://raw.githubusercontent.com/jenkinsci/helm-charts/main/charts/jenkins/values.yaml target=_blank rel=noopener>https://raw.githubusercontent.com/jenkinsci/helm-charts/main/charts/jenkins/values.yaml</a></li><li>Kubernetes Service (NodePort): <a class=link href=https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport target=_blank rel=noopener>https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport</a></li></ul><h3 id=–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-4>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /k3s-1c-ci/jenkins
</span></span><span style=display:flex><span>cd /k3s-1c-ci/jenkins
</span></span></code></pre></div><p>–î–∞–ª—å—à–µ –≤—Å–µ —Ñ–∞–π–ª—ã –±—É–¥—É—Ç –ª–µ–∂–∞—Ç—å –≤ —ç—Ç–æ–π –ø–∞–ø–∫–µ.</p><h3 id=—Å–æ–∑–¥–∞–µ–º-namespace-jenkins>–°–æ–∑–¥–∞–µ–º namespace <code>jenkins</code></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace jenkins --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><h3 id=tls-secret-–∏–∑-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞-2>TLS Secret –∏–∑ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h3><p>–ö–æ–º–∞–Ω–¥–∞ —Å–æ–∑–¥–∞–µ—Ç Secret –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –±—ã–ª –ø–µ—Ä–µ–≤—ã–ø—É—â–µ–Ω —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create secret tls onecci.lan.tls <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --cert<span style=color:#f92672>=</span>/k3s-1c-ci/tls/tls.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --key<span style=color:#f92672>=</span>/k3s-1c-ci/tls/tls.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n jenkins <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get secret onecci.lan.tls -n jenkins
</span></span></code></pre></div><h3 id=—Å–æ–∑–¥–∞–µ–º-configmap-—Å-–∫–æ—Ä–Ω–µ–≤—ã–º-ca-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º>–°–æ–∑–¥–∞–µ–º ConfigMap —Å –∫–æ—Ä–Ω–µ–≤—ã–º CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º</h3><p>–ö–æ—Ä–Ω–µ–≤–æ–π CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Kubernetes –≤ –≤–∏–¥–µ ConfigMap.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create configmap onecci-root-ca <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --from-file<span style=color:#f92672>=</span>onecci-root-ca.crt<span style=color:#f92672>=</span>/k3s-1c-ci/tls/onecci-root-ca.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n jenkins
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n jenkins get configmap onecci-root-ca
</span></span><span style=display:flex><span>kubectl -n jenkins describe configmap onecci-root-ca
</span></span></code></pre></div><h3 id=–¥–æ–±–∞–≤–ª—è–µ–º-helm-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π-jenkins>–î–æ–±–∞–≤–ª—è–µ–º Helm-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Jenkins</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add jenkinsci https://charts.jenkins.io
</span></span><span style=display:flex><span>helm repo update
</span></span></code></pre></div><h3 id=—Å–æ–∑–¥–∞–µ–º-persistentvolume-–∏-storageclass>–°–æ–∑–¥–∞–µ–º PersistentVolume –∏ StorageClass</h3><p>Jenkins –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ (<code>/var/jenkins_home</code>) –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–º–∏ Pod.</p><p>–°–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ –Ω–∞ –Ω–æ–¥–µ(–∞—Ö), –≥–¥–µ –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è Jenkins home:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /data/jenkins-volume
</span></span><span style=display:flex><span>sudo chown -R 1000:1000 /data/jenkins-volume
</span></span></code></pre></div><p>–°–∫–∞—á–∏–≤–∞–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –º–∞–Ω–∏—Ñ–µ—Å—Ç PV/StorageClass –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –µ–≥–æ:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL -o jenkins-01-volume.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  https://raw.githubusercontent.com/jenkins-infra/jenkins.io/master/content/doc/tutorials/kubernetes/installing-jenkins-on-kubernetes/jenkins-01-volume.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f jenkins-01-volume.yaml
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pv
</span></span><span style=display:flex><span>kubectl get storageclass
</span></span></code></pre></div><h3 id=—Å–æ–∑–¥–∞–µ–º-serviceaccount-–∏-rbac>–°–æ–∑–¥–∞–µ–º ServiceAccount –∏ RBAC</h3><p>Jenkins –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∞–≥–µ–Ω—Ç—ã (Pods) –≤ Kubernetes. –î–ª—è —ç—Ç–æ–≥–æ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è ServiceAccount <code>jenkins</code> –∏ –≤—ã–¥–∞—é—Ç—Å—è –ø—Ä–∞–≤–∞ —á–µ—Ä–µ–∑ ClusterRole/ClusterRoleBinding.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL -o jenkins-02-sa.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  https://raw.githubusercontent.com/jenkins-infra/jenkins.io/master/content/doc/tutorials/kubernetes/installing-jenkins-on-kubernetes/jenkins-02-sa.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f jenkins-02-sa.yaml
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n jenkins get sa
</span></span><span style=display:flex><span>kubectl get clusterrole jenkins
</span></span><span style=display:flex><span>kubectl get clusterrolebinding jenkins
</span></span></code></pre></div><h3 id=–≥–æ—Ç–æ–≤–∏–º-jenkins-valuesyaml>–ì–æ—Ç–æ–≤–∏–º <code>jenkins-values.yaml</code></h3><p>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è Jenkins –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–∑—è—Ç—å <code>values.yaml</code> Helm-—á–∞—Ä—Ç–∞ –∫–∞–∫ —à–∞–±–ª–æ–Ω –∏ –≤–Ω–µ—Å—Ç–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫. –¢–∞–∫ –∏ –ø–æ—Å—Ç—É–ø–∏–º.</p><p>–°–∫–∞—á–∏–≤–∞–µ–º —à–∞–±–ª–æ–Ω <code>values.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL -o jenkins-values.yaml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  https://raw.githubusercontent.com/jenkinsci/helm-charts/main/charts/jenkins/values.yaml
</span></span></code></pre></div><p>–û—Ç–∫—Ä—ã–≤–∞–µ–º –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è <code>jenkins-values.yaml</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano jenkins-values.yaml
</span></span></code></pre></div><h4 id=serviceaccount-–∏—Å–ø–æ–ª—å–∑—É–µ–º-—Å–æ–∑–¥–∞–Ω–Ω—ã–π-jenkins>ServiceAccount (–∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π <code>jenkins</code>)</h4><p>–ë–ª–æ–∫ <code>serviceAccount</code>, —É–∫–∞–∑—ã–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –Ω–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>serviceAccount</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>create</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>annotations</span>: {}
</span></span></code></pre></div><h4 id=—Å–µ—Ä–≤–∏—Å-nodeport-32000>–°–µ—Ä–≤–∏—Å (NodePort 32000)</h4><p>–ë–ª–æ–∫ <code>controller</code> - <code>serviceType</code> –∏ <code>nodePort</code>, –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>controller</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>serviceType</span>: <span style=color:#ae81ff>NodePort</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>nodePort</span>: <span style=color:#ae81ff>32000</span>
</span></span></code></pre></div><h4 id=—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã-–ø—Ä–∞–≤–∏–º-–≤-—Ä–∞–∑–¥–µ–ª–µ-controller>–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –ø—Ä–∞–≤–∏–º –≤ —Ä–∞–∑–¥–µ–ª–µ controller:</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>controller</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># --- CA: –¥–ª—è git ---</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>containerEnv</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>GIT_SSL_CAINFO</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>value</span>: <span style=color:#ae81ff>/usr/local/share/onecci-ca/onecci-root-ca.crt</span>
</span></span></code></pre></div><p>GIT_SSL_CAINFO –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è git/curl, –æ–Ω –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ Java (jnlp-–∞–≥–µ–Ω—Ç—ã, Sonar).<br>–î–ª—è jnlp-–∞–≥–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è internal HTTP URL Jenkins.</p><h4 id=–æ—Ç–∫–ª—é—á–∞–µ–º-jcasc>–û—Ç–∫–ª—é—á–∞–µ–º JCasC</h4><p>–û—Ç–∫–ª—é—á–∞–µ–º JCasC (Jenkins Configuration as Code), —á—Ç–æ–±—ã –Ω–∞—à–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª–∏—Å—å –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞—Ö. (–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ YAML).<br>–í —Ä–∞–∑–¥–µ–ª–µ <code>controller</code> - <code>JCasC</code> –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å <code>defaultConfig</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>controller</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>JCasC</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>defaultConfig</span>: <span style=color:#66d9ef>false</span>
</span></span></code></pre></div><h4 id=—Ö—Ä–∞–Ω–∏–ª–∏—â–µ-storageclass-jenkins-pv>–•—Ä–∞–Ω–∏–ª–∏—â–µ (storageClass: jenkins-pv)</h4><p>–ë–ª–æ–∫ <code>persistence</code> –∏ –≤–∫–ª—é—á–∏—Ç–µ persistence, —É–∫–∞–∑–∞–≤ storageClass <code>jenkins-pv</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>persistence</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>storageClass</span>: <span style=color:#ae81ff>jenkins-pv</span>
</span></span></code></pre></div><h4 id=–º–æ–Ω—Ç–∏—Ä—É–µ–º-—Ä–∞–∑–¥–µ–ª-—Å-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏>–ú–æ–Ω—Ç–∏—Ä—É–µ–º —Ä–∞–∑–¥–µ–ª —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>persistence</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># CA –º–æ–Ω—Ç–∏—Ä—É–µ–º –≤ Pod –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –∫–∞–∫ volume</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>onecci-root-ca</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>configMap</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>onecci-root-ca</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>mounts</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>onecci-root-ca</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/usr/local/share/onecci-ca</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>readOnly</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><h4 id=–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å-–ø–ª–∞–≥–∏–Ω—ã-—Ç–æ–ª—å–∫–æ-–æ–¥–∏–Ω-—Ä–∞–∑>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω—ã —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑</h4><p>–ò—â–µ–º –±–ª–æ–∫ <code>controller</code> -> <code>initializeOnce</code>, –≤–∫–ª—é—á–∞–µ–º:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>controller</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>initializeOnce</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p><code>values.yaml</code> –≥–æ—Ç–æ–≤.</p><h3 id=—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º-jenkins>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Jenkins</h3><p>–ö–æ–º–∞–Ω–¥–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>chart<span style=color:#f92672>=</span>jenkinsci/jenkins
</span></span><span style=display:flex><span>helm install jenkins -n jenkins -f jenkins-values.yaml $chart
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -n jenkins
</span></span><span style=display:flex><span>kubectl get svc -n jenkins
</span></span></code></pre></div><p>–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫, –µ—Å–ª–∏ –º–µ–Ω—è–ª—Å—è values.yaml.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm upgrade jenkins jenkins/jenkins <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n jenkins <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -f jenkins-values.yaml
</span></span></code></pre></div><h3 id=–ø–æ–ª—É—á–∞–µ–º-–ø–∞—Ä–æ–ª—å-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞>–ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3><p>–ö–æ–º–∞–Ω–¥–∞ –∏–∑ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ Jenkins (–ø–∞—Ä–æ–ª—å —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Kubernetes Secret —Ä–µ–ª–∏–∑–∞ <code>jenkins</code>):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.data.jenkins-admin-password}&#34;</span>
</span></span><span style=display:flex><span>secret<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>kubectl get secret -n jenkins jenkins -o jsonpath<span style=color:#f92672>=</span>$jsonpath<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>echo <span style=color:#66d9ef>$(</span>echo $secret | base64 --decode<span style=color:#66d9ef>)</span>
</span></span></code></pre></div><p>–õ–æ–≥–∏–Ω: <code>admin</code>, –µ—Å–ª–∏ –Ω–µ –º–µ–Ω—è–ª–∏ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏.</p><h3 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-jenkins-url-–¥–ª—è-kubernetes-–∞–≥–µ–Ω—Ç–æ–≤>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins URL –¥–ª—è Kubernetes-–∞–≥–µ–Ω—Ç–æ–≤</h3><p>Jenkins UI –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ HTTPS —á–µ—Ä–µ–∑ Ingress, –∞ Kubernetes-–∞–≥–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ Jenkins –ø–æ internal Service –±–µ–∑ TLS.</p><p>–í—ã–ø–æ–ª–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Jenkins:</p><p><strong>Manage Jenkins</strong> - <strong>System</strong> - <strong>Jenkins Location</strong></p><p>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Jenkins URL:
<a class=link href=http://jenkins.jenkins.svc.cluster.local:8080 target=_blank rel=noopener>http://jenkins.jenkins.svc.cluster.local:8080</a></p><h3 id=–ø–ª–∞–≥–∏–Ω—ã-–∫–æ—Ç–æ—Ä—ã–µ-–Ω—É–∂–Ω–æ-—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å>–ü–ª–∞–≥–∏–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</h3><p>–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Jenkins <strong>Manage Jenkins</strong> - <strong>Plugins</strong> - –≤–∫–ª–∞–¥–∫–∞ <strong>Available plugins</strong></p><div class=table-wrapper><table><thead><tr><th>–ü–ª–∞–≥–∏–Ω</th><th>ID</th><th>–ß—Ç–æ –¥–µ–ª–∞–µ—Ç</th></tr></thead><tbody><tr><td>Blue Ocean</td><td><code>blueocean</code></td><td>UI –¥–ª—è –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ (–≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–¥–∏–∏ –∏ —à–∞–≥–∏).</td></tr><tr><td>Git Pipeline for Blue Ocean</td><td><code>blueocean-git-pipeline</code></td><td>Git-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è Blue Ocean.</td></tr><tr><td>Pipeline implementation for Blue Ocean</td><td><code>blueocean-pipeline-api-impl</code></td><td>–†–µ–∞–ª–∏–∑–∞—Ü–∏—è Pipeline API –¥–ª—è Blue Ocean.</td></tr><tr><td>Copy Artifact</td><td><code>copyartifact</code></td><td>–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –º–µ–∂–¥—É job/build.</td></tr><tr><td>HTTP Request</td><td><code>http_request</code></td><td>–®–∞–≥–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ Pipeline.</td></tr><tr><td>Node and Label parameter</td><td><code>nodelabelparameter</code></td><td>–ü–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω–æ–¥—ã/–ª–µ–π–±–ª–∞ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ job.</td></tr><tr><td>Pipeline Aggregator View</td><td><code>pipeline-aggregator-view</code></td><td>–°–≤–æ–¥–Ω—ã–π —ç–∫—Ä–∞–Ω –ø–∞–π–ø–ª–∞–π–Ω–æ–≤ –ø–æ —Å—Ç–∞–¥–∏—è–º.</td></tr><tr><td>Pipeline Configuration History</td><td><code>pipeline-config-history</code></td><td>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ job/–ø–∞–π–ø–ª–∞–π–Ω–æ–≤.</td></tr><tr><td>Pipeline GitHub Notify Step</td><td><code>pipeline-githubnotify-step</code></td><td>–®–∞–≥ <code>githubNotify</code> –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –≤ GitHub.</td></tr><tr><td>Pipeline: Multibranch with defaults</td><td><code>pipeline-multibranch-defaults</code></td><td>–î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ multibranch-–ø–∞–π–ø–ª–∞–π–Ω–æ–≤.</td></tr><tr><td>Pipeline timeline</td><td><code>pipeline-timeline</code></td><td>–¢–∞–π–º–ª–∞–π–Ω —Å—Ç–∞–¥–∏–π –ø–∞–π–ø–ª–∞–π–Ω–∞ (–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏).</td></tr><tr><td>Pipeline Utility Steps</td><td><code>pipeline-utility-steps</code></td><td>–£—Ç–∏–ª–∏—Ç—ã –≤ pipeline (readYaml, writeYaml, zip –∏ —Ç.–¥.).</td></tr><tr><td>SonarQube Scanner</td><td><code>sonar</code></td><td>–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Jenkins —Å SonarQube –∏ quality gate.</td></tr><tr><td>Throttle Concurrent Builds</td><td><code>throttle-concurrents</code></td><td>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–±–æ—Ä–æ–∫.</td></tr><tr><td>Kubernetes</td><td><code>kubernetes</code></td><td>–ó–∞–ø—É—Å–∫ Jenkins agents –∫–∞–∫ Pod –≤ Kubernetes.</td></tr><tr><td>Pipeline</td><td><code>workflow-aggregator</code></td><td>–ù–∞–±–æ—Ä –±–∞–∑–æ–≤—ã—Ö Pipeline-–ø–ª–∞–≥–∏–Ω–æ–≤.</td></tr><tr><td>Git</td><td><code>git</code></td><td>Git checkout/fetch –∏ —Ç.–ø.</td></tr><tr><td>Configuration as Code</td><td><code>configuration-as-code</code></td><td>Jenkins Configuration as Code (JCasC).</td></tr><tr><td>Allure</td><td><code>allure</code></td><td>Allure jenkins plugin</td></tr><tr><td>File Operations</td><td><code>FileOperation</code></td><td>File Operations Plugin</td></tr><tr><td>Timestamper</td><td><code>Timestamper</code></td><td></td></tr></tbody></table></div><hr><h3 id=–æ—Ç–∫–ª—é—á–∞–µ–º-–ø–ª–∞–≥–∏–Ω—ã-–∏–∑-—Å–ø–∏—Å–∫–∞>–û—Ç–∫–ª—é—á–∞–µ–º –ø–ª–∞–≥–∏–Ω—ã –∏–∑ —Å–ø–∏—Å–∫–∞</h3><p>–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Jenkins <strong>Manage Jenkins</strong> - <strong>Plugins</strong> - –≤–∫–ª–∞–¥–∫–∞ <strong>Installed</strong></p><p>–û—Ç–∫–ª—é—á–∞–µ–º –ø–ª–∞–≥–∏–Ω—ã</p><div class=table-wrapper><table><thead><tr><th>–ü–ª–∞–≥–∏–Ω</th><th>ID</th><th>–ß—Ç–æ –¥–µ–ª–∞–µ—Ç</th></tr></thead><tbody><tr><td>OWASP Markup Formatter</td><td><code>antisamy-markup-formatter</code></td><td>–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è HTML-—Ä–∞–∑–º–µ—Ç–∫–∏ –≤ –æ–ø–∏—Å–∞–Ω–∏—è—Ö/–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö.</td></tr><tr><td>Ant</td><td><code>ant</code></td><td>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Ant build steps.</td></tr><tr><td>Gradle</td><td><code>gradle</code></td><td>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Gradle build steps.</td></tr><tr><td>Matrix Authorization Strategy</td><td><code>matrix-auth</code></td><td>–ú–∞—Ç—Ä–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å –ø—Ä–∞–≤.</td></tr><tr><td>PAM Authentication</td><td><code>pam-auth</code></td><td>PAM-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Linux).</td></tr><tr><td>LDAP</td><td><code>ldap</code></td><td>LDAP/AD-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.</td></tr></tbody></table></div><h2 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-jenkins>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins</h2><h3 id=–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ-kubernetes-–¥–ª—è-–∞–≥–µ–Ω—Ç–æ–≤>–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Kubernetes –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤</h3><p>Jenkins —Å–æ–∑–¥–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ Pod-—ã –∞–≥–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Kubernetes API.</p><h3 id=–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-—Ä–∞–±–æ—á–µ–π-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏-5>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏</h3><p>–í—Å–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã –∏ —Ñ–∞–π–ª—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ Jenkins –∏ –∞–≥–µ–Ω—Ç–∞–º, —Ö—Ä–∞–Ω–∏–º –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p /k3s-1c-ci/jenkins/agents
</span></span><span style=display:flex><span>cd /k3s-1c-ci/jenkins/agents
</span></span></code></pre></div><p>–ï—Å–ª–∏ –ø—Ä–∞–≤–∞ –Ω–∞ <code>/k3s-1c-ci</code> –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª–∏—Å—å:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chgrp -R k3s /k3s-1c-ci
</span></span><span style=display:flex><span>sudo chmod -R <span style=color:#ae81ff>2775</span> /k3s-1c-ci
</span></span></code></pre></div><h3 id=—Å–æ–∑–¥–∞–µ–º-–æ—Ç–¥–µ–ª—å–Ω—ã–π-namespace-–¥–ª—è-jenkins-–∞–≥–µ–Ω—Ç–æ–≤>–°–æ–∑–¥–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–π namespace –¥–ª—è Jenkins-–∞–≥–µ–Ω—Ç–æ–≤</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace jenkins-agents --dry-run<span style=color:#f92672>=</span>client -o yaml | kubectl apply -f -
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get namespace jenkins-agents
</span></span></code></pre></div><h3 id=—Å–æ–∑–¥–∞–µ–º-—Å–µ–∫—Ä–µ—Ç-—Å-—É—á–µ—Ç–Ω—ã–º–∏-–¥–∞–Ω–Ω—ã–º–∏-–¥–ª—è-–¥–æ—Å—Ç—É–ø–∞-–∫-registry>–°–æ–∑–¥–∞–µ–º —Å–µ–∫—Ä–µ—Ç —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ registry</h3><p>–ê–≥–µ–Ω—Ç—ã - —ç—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ Pod-—ã –∑–∞–ø—É—Å–∫–∞—Ç—å –∏—Ö –±—É–¥–µ–º –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º namespace.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n jenkins-agents create secret docker-registry registry-auth <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --docker-server<span style=color:#f92672>=</span>registry.onecci.lan <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --docker-username<span style=color:#f92672>=</span>registryusr <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --docker-password<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;registrypass&#39;</span>
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n jenkins-agents get secret registry-auth
</span></span></code></pre></div><h3 id=serviceaccount-–¥–ª—è-jenkins-–∞–≥–µ–Ω—Ç–æ–≤>ServiceAccount –¥–ª—è Jenkins-–∞–≥–µ–Ω—Ç–æ–≤</h3><p>Jenkins Kubernetes plugin —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç –∏–º–µ–Ω–∏ ServiceAccount, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ Pod Template.</p><p>–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª <code>sa-jenkins-agent.yaml</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano sa-jenkins-agent.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins-agent</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>jenkins-agents</span>
</span></span><span style=display:flex><span><span style=color:#f92672>imagePullSecrets</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>registry-auth</span>
</span></span></code></pre></div><p>–ü—Ä–∏–º–µ–Ω—è–µ–º:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f sa-jenkins-agent.yaml
</span></span></code></pre></div><h3 id=–ø—Ä–∞–≤–∞-–¥–ª—è-—Å–æ–∑–¥–∞–Ω–∏—è-–∏-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è-pod-–∞–º–∏-rbac>–ü—Ä–∞–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Pod-–∞–º–∏ (RBAC)</h3><p>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤, —á—Ç–æ–±—ã Jenkins –º–æ–≥ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–æ–≤.</p><h4 id=role-–ø—Ä–∞–≤–∞-–≤–Ω—É—Ç—Ä–∏-namespace>Role (–ø—Ä–∞–≤–∞ –≤–Ω—É—Ç—Ä–∏ namespace)</h4><p>–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª <code>role-jenkins-agent.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano role-jenkins-agent.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Role</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins-agent-role</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>jenkins-agents</span>
</span></span><span style=display:flex><span><span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>apiGroups</span>: [<span style=color:#e6db74>&#34;&#34;</span>]
</span></span><span style=display:flex><span>    <span style=color:#f92672>resources</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>pods</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>pods/log</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>pods/exec</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>events</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>configmaps</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>secrets</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>verbs</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>get</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>list</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>watch</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>create</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>delete</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>patch</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>update</span>
</span></span></code></pre></div><blockquote><p>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: <code>configmaps</code> –∏ <code>secrets</code> –Ω—É–∂–Ω—ã, –µ—Å–ª–∏ —Ç—ã –º–æ–Ω—Ç–∏—Ä—É–µ—à—å –∏—Ö –≤ –∞–≥–µ–Ω—Ç—Å–∫–∏–µ Pod-—ã. –ï—Å–ª–∏ –Ω–µ—Ç - –º–æ–∂–Ω–æ –ø–æ–∑–∂–µ —É–∂–µ—Å—Ç–æ—á–∏—Ç—å.</p></blockquote><h4 id=rolebinding>RoleBinding</h4><p>–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª <code>rb-jenkins-agent.yaml</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>nano rb-jenkins-agent.yaml
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>RoleBinding</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins-agent-rb</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>jenkins-agents</span>
</span></span><span style=display:flex><span><span style=color:#f92672>subjects</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ServiceAccount</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins-agent</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>jenkins-agents</span>
</span></span><span style=display:flex><span><span style=color:#f92672>roleRef</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Role</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jenkins-agent-role</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>apiGroup</span>: <span style=color:#ae81ff>rbac.authorization.k8s.io</span>
</span></span></code></pre></div><p>–ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ RBAC-–º–∞–Ω–∏—Ñ–µ—Å—Ç—ã:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl apply -f role-jenkins-agent.yaml
</span></span><span style=display:flex><span>kubectl apply -f rb-jenkins-agent.yaml
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n jenkins-agents get sa
</span></span><span style=display:flex><span>kubectl -n jenkins-agents get role,rolebinding
</span></span></code></pre></div><h3 id=–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-ca-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞</h3><p>–ö–æ—Ä–Ω–µ–≤–æ–π CA-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏,
–∫–æ—Ç–æ—Ä—ã–µ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ —Å–µ—Ä–≤–∏—Å–∞–º <code>*.onecci.lan</code> –ø–æ HTTPS.</p><p>–°–æ–∑–¥–∞–µ–º - <strong>ConfigMap</strong> (CA –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º). ConfigMap —Å–æ–∑–¥–∞–µ—Ç—Å—è <strong>–≤ –∫–∞–∂–¥–æ–º namespace</strong>, –≥–¥–µ –µ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç—ã (Jenkins, CI-–∞–≥–µ–Ω—Ç—ã –∏ —Ç.–¥.).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create configmap onecci-root-ca <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  --from-file<span style=color:#f92672>=</span>onecci-root-ca.crt<span style=color:#f92672>=</span>/k3s-1c-ci/tls/onecci-root-ca.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span>  -n jenkins-agents 
</span></span></code></pre></div><h3 id=jenkins-–¥–æ–±–∞–≤–ª—è–µ–º-kubernetes-cloud>Jenkins: –¥–æ–±–∞–≤–ª—è–µ–º Kubernetes Cloud</h3><pre tabindex=0><code>Manage Jenkins - Nodes and Clouds - Configure Clouds
</code></pre><h4 id=add-a-new-cloud---kubernetes>Add a new cloud - Kubernetes</h4><p><strong>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:</strong></p><div class=table-wrapper><table><thead><tr><th>–ü–æ–ª–µ</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th></tr></thead><tbody><tr><td>Kubernetes URL</td><td><code>https://kubernetes.default.svc.cluster.local</code></td></tr><tr><td>Kubernetes Namespace</td><td><code>jenkins-agents</code></td></tr><tr><td>Credentials</td><td><code>- none -</code></td></tr><tr><td>Jenkins URL</td><td><code>https://jenkins.onecci.lan</code></td></tr></tbody></table></div><p>–ñ–º–µ–º <strong>Test Connection</strong> - –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å–ø–µ—à–Ω–æ.</p><p>–í Kubernetes URL –º—ã —É–∫–∞–∑–∞–ª–∏ kubernetes.default.svc - —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Service Kubernetes, –∫–æ—Ç–æ—Ä—ã–π –≤—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ API-server —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞. –ú—ã —É–∫–∞–∑—ã–≤–∞–µ–º —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ, –ø–æ—Ç–æ–º—É —á—Ç–æ Jenkins —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –∂–µ k3s-–∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ Kubernetes API –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É DNS-–∏–º–µ–Ω–∏.</p><h3 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-jenkins-–∞–≥–µ–Ω—Ç–æ–≤-1—Å>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins –∞–≥–µ–Ω—Ç–æ–≤ 1–°</h3><p>–ú—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–ª–∏ –¥–æ—Å—Ç—É–ø –∫ Docker Registry –ø–æ –ø—Ä—è–º–æ–º—É –∞–¥—Ä–µ—Å—É –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø–æ—Ä—Ç–∞ <code>https://registry.onecci.lan</code></p><h3 id=–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-docker-–æ–±—Ä–∞–∑–∞-jenkins-–∞–≥–µ–Ω—Ç–∞-1—Å>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker-–æ–±—Ä–∞–∑–∞ Jenkins-–∞–≥–µ–Ω—Ç–∞ 1–°</h3><p>–î–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ —Å–∫—Ä–∏–ø—Ç–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã 1–° –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è Jenkins-–∞–≥–µ–Ω—Ç–∞.</p><p>–ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/Daabramov/Sonarqube-for-1c-docker.git
</span></span><span style=display:flex><span>cd onec-docker
</span></span></code></pre></div><h4 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤-—Å–±–æ—Ä–∫–∏>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å–±–æ—Ä–∫–∏</h4><p>–°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cp .onec.env.example .env
</span></span><span style=display:flex><span>nano .env
</span></span></code></pre></div><p>–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-env data-lang=env><span style=display:flex><span>ONEC_VERSION<span style=color:#f92672>=</span>8.3.27.1606
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ONEC_USERNAME<span style=color:#f92672>=</span>...
</span></span><span style=display:flex><span>ONEC_PASSWORD<span style=color:#f92672>=</span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DOCKER_REGISTRY<span style=color:#f92672>=</span>registry.onecci.lan
</span></span><span style=display:flex><span>DOCKER_IMAGE_PREFIX<span style=color:#f92672>=</span>onec
</span></span></code></pre></div><p>–ü–æ—è—Å–Ω–µ–Ω–∏—è:</p><ul><li><code>ONEC_VERSION</code> - –≤–µ—Ä—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã 1–°, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –≤ –æ–±—Ä–∞–∑</li><li><code>ONEC_USERNAME / ONEC_PASSWORD</code> - —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–æ–≤ 1–°</li><li><code>DOCKER_REGISTRY</code> - –∞–¥—Ä–µ—Å –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ Registry (–±–µ–∑ –ø–æ—Ä—Ç–∞)</li><li><code>DOCKER_IMAGE_PREFIX</code> - –ø—Ä–µ—Ñ–∏–∫—Å –∏–º–µ–Ω –æ–±—Ä–∞–∑–æ–≤</li></ul><h4 id=—Å–±–æ—Ä–∫–∞-–æ–±—Ä–∞–∑–∞-jenkins-–∞–≥–µ–Ω—Ç–∞>–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ Jenkins-–∞–≥–µ–Ω—Ç–∞</h4><p>–î–ª—è Jenkins –≤ Kubernetes –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Å–±–æ—Ä–∫–∏:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>chmod +x build-base-k8s-jenkins-agent.sh
</span></span><span style=display:flex><span>./build-base-k8s-jenkins-agent.sh
</span></span></code></pre></div><p>–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ:</p><ul><li>—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è Docker-–æ–±—Ä–∞–∑ –∞–≥–µ–Ω—Ç–∞;</li><li>–æ–±—Ä–∞–∑ —Ç–µ–≥–∏—Ä—É–µ—Ç—Å—è –≤–µ—Ä—Å–∏–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã 1–°;</li><li>–æ–±—Ä–∞–∑ –ø—É–±–ª–∏–∫—É–µ—Ç—Å—è –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π Registry.</li></ul><p>–ü—Ä–∏–º–µ—Ä –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞:</p><pre tabindex=0><code>registry.onecci.lan/jenkins-agent:8.3.27.1606
</code></pre><hr><h3 id=–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-jenkins-–∞–≥–µ–Ω—Ç–∞-–≤-jenkins-pod-template>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ Jenkins-–∞–≥–µ–Ω—Ç–∞ –≤ Jenkins (Pod Template)</h3><p><strong>Manage Jenkins</strong> - <strong>Clouds</strong> - <strong>Kubernetes</strong> - <strong>Pod Templates</strong> - <strong>Add Pod Template</strong></p><h4 id=–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã-pod-template>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Pod Template</h4><div class=table-wrapper><table><thead><tr><th>–ü–æ–ª–µ</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th></tr></thead><tbody><tr><td>Name</td><td>onec-8-3-27-1606</td><td>-</td></tr><tr><td>Namespace</td><td>jenkins-agents</td><td>namespace, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å–æ–∑–¥–∞—é—Ç—Å—è Pod-—ã –∞–≥–µ–Ω—Ç–æ–≤</td></tr><tr><td>Labels</td><td>8.3.27.1606 agent</td><td>–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Jenkins –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞</td></tr><tr><td>Image Pull Secret</td><td>registry-auth</td><td>—Å–µ–∫—Ä–µ—Ç —Å —É—á–µ—Ç–∫–æ–π –¥–ª—è registry</td></tr><tr><td>Service Account</td><td>jenkins-agent</td><td>—É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å Kubernetes –¥–ª—è Pod-–∞</td></tr></tbody></table></div><h4 id=—Ä–∞–∑–¥–µ–ª-—Å-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º>–†–∞–∑–¥–µ–ª —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º</h4><ol><li><strong>Volumes</strong> - <strong>Add Volume</strong>.<br>–¢–∏–ø <strong>Config Map Volume</strong>.</li></ol><ul><li><strong>Name</strong> - <code>onecci-root-ca</code></li><li><strong>Mount path</strong> - <code>/etc/gitlab-ca</code></li></ul><ol><li>Environment Variables - Add Environment Variable.<br>–¢–∏–ø <strong>Environment Variable</strong>.</li></ol><ul><li><strong>Key</strong> - <code>GIT_SSL_CAINFO</code></li><li><strong>Value</strong> - <code>/etc/gitlab-ca/onecci-root-ca.crt</code></li></ul><h4 id=–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä-–∞–≥–µ–Ω—Ç–∞>–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≥–µ–Ω—Ç–∞</h4><p>–î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ Pod Template.</p><div class=table-wrapper><table><thead><tr><th>–ü–æ–ª–µ</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th></tr></thead><tbody><tr><td>Name</td><td><code>jnlp</code></td><td>–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–º–µ–Ω–µ–º <code>jnlp</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Kubernetes plugin –∫–∞–∫ Jenkins-–∞–≥–µ–Ω—Ç</td></tr><tr><td>Docker image</td><td><code>registry.onecci.lan/base-jenkins-agent:8.3.27.1606</code></td><td>-</td></tr><tr><td>Working directory</td><td><code>/home/jenkins</code></td><td>—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è Jenkins</td></tr></tbody></table></div><p>–†–∞—Å–∫—Ä—ã–≤–∞–µ–º Advanced</p><div class=table-wrapper><table><thead><tr><th>–ü–æ–ª–µ</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th></tr></thead><tbody><tr><td>Run As User ID</td><td><code>0</code></td><td>–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ–¥ root</td></tr><tr><td>Limit Memory</td><td><code>1024Mi</code></td><td>–ª–∏–º–∏—Ç –ø–æ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (–≤ kubernetes —Å —ç—Ç–∏–º —Å—Ç—Ä–æ–≥–æ)</td></tr></tbody></table></div><p>–ñ–º–µ–º <strong>Save</strong> –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫.</p><h3 id=–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-jenkins-–∞–≥–µ–Ω—Ç–æ–≤-sonarqube>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins –∞–≥–µ–Ω—Ç–æ–≤ SonarQube</h3><p>–ü–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∞–≥–µ–Ω—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é Jenkins –≤ SonarQube.<br>Jenkins –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –≤ SonarQube —á–µ—Ä–µ–∑ API-token, –∞ Kubernetes-–∞–≥–µ–Ω—Ç—ã –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é Jenkins SonarQube.</p><h3 id=–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-—Ç–æ–∫–µ–Ω–∞-–≤-sonarqube>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –≤ SonarQube</h3><p>–ó–∞—Ö–æ–¥–∏–º –≤ SonarQube –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å –ø—Ä–∞–≤–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞ (–æ–±—ã—á–Ω–æ admin).</p><p>–í –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É - <strong>–∏–∫–æ–Ω–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (A)</strong> - <strong>My Account</strong>.</p><p>–í–∫–ª–∞–¥–∫–∞ <strong>Security</strong>.</p><p>–í –±–ª–æ–∫–µ <strong>Generate Tokens</strong> –∑–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è:</p><ul><li><strong>Name</strong>: <code>jenkins</code></li><li><strong>Type</strong>: <code>User Token</code></li><li><strong>Expires in</strong>: <code>No expiration</code></li></ul><p>–ù–∞–∂–∏–º–∞–µ–º <strong>Generate</strong></p><p>–°—Ä–∞–∑—É –∫–æ–ø–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω, –ø–æ–≤—Ç–æ—Ä–Ω–æ –µ–≥–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–µ–ª—å–∑—è.</p><h3 id=–¥–æ–±–∞–≤–ª—è–µ–º-sonarqube-–≤-jenkins>–î–æ–±–∞–≤–ª—è–µ–º SonarQube –≤ Jenkins</h3><p>–ó–∞—Ö–æ–¥–∏–º –≤ Jenkins.</p><p><strong>Manage Jenkins</strong> - <strong>System</strong></p><p>–ò—â–µ–º —Ä–∞–∑–¥–µ–ª <strong>SonarQube servers</strong><br>–ù–∞–∂–∏–º–∞–µ–º <strong>Add SonarQube</strong></p><p>–ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è:</p><ul><li><strong>Name</strong>: <code>SonarQube</code></li><li><strong>Server URL</strong>: <code>http://sonarqube-sonarqube.sonarqube.svc.cluster.local:9000</code></li><li><strong>Server authentication token</strong>: <strong>Add</strong> - <strong>Jenkins</strong></li></ul><p><strong>Credential</strong></p><p>–í –æ–∫–Ω–µ <strong>Add Credential</strong>:</p><ul><li><strong>Kind</strong>: <code>Secret text</code></li><li><strong>Secret</strong>: <code>(–≤—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –∏–∑ SonarQube)</code></li><li><strong>Description</strong>: <code>sonarqube admin token</code></li></ul><p>–ù–∞–∂–∏–º–∞–µ–º Add, –≤—ã–±–∏—Ä–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π credential –∏ –∂–º–µ–º <strong>Save</strong>.</p><h3 id=–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ-–∞–≥–µ–Ω—Ç–∞-–≤-jenkins-pod-template>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –≤ Jenkins (Pod Template)</h3><p>–í –æ—Ç–ª–∏—á–∏–∏ –æ—Ç –∞–≥–µ–Ω—Ç–æ–≤ 1–° –∑–¥–µ—Å—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –æ–±—Ä–∞–∑ –¥–ª—è –∞–≥–µ–Ω—Ç–∞.<br>–í docker-swarm –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –æ—Ñ–∏—Ü–∏–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ –∞–≥–µ–Ω—Ç–∞ sonarqube, –≤ –∫–æ—Ç–æ—Ä—ã–π –∫–æ–º–∞–Ω–¥–∞–º–∏ –∑–∞–ø—É—Å–∫–∞ –¥–æ–±–∞–≤–ª—è–ª—Å—è –∞–≥–µ–Ω—Ç –¥–∂–µ–Ω–∫–∏–Ω—Å–∞. –¢–µ–ø–µ—Ä—å —ç—Ç–æ—Ç —Ñ–æ–∫—É—Å –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç. –ú—ã –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–∂–µ–Ω–∫–∏–Ω—Å–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π –¥–æ—É—Å—Ç–∞–Ω–æ–≤–∏–º —Ñ–∞–π–ª—ã –¥–ª—è sonar-scanner.</p><p><strong>Manage Jenkins</strong> - <strong>Clouds</strong> - <strong>Kubernetes</strong> - <strong>Pod Templates</strong> - <strong>Add Pod Template</strong></p><h4 id=–æ—Å–Ω–æ–≤–Ω—ã–µ-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã-pod-template-1>–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã Pod Template</h4><div class=table-wrapper><table><thead><tr><th>–ü–æ–ª–µ</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th></tr></thead><tbody><tr><td>Name</td><td><code>sonar</code></td><td>-</td></tr><tr><td>Namespace</td><td><code>jenkins-agents</code></td><td>namespace, –≤ –∫–æ—Ç–æ—Ä–æ–º —Å–æ–∑–¥–∞—é—Ç—Å—è Pod-—ã –∞–≥–µ–Ω—Ç–æ–≤</td></tr><tr><td>Labels</td><td><code>sonar</code></td><td>–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Jenkins –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞</td></tr><tr><td>Service Account</td><td><code>jenkins-agent</code></td><td>—É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å Kubernetes –¥–ª—è Pod-–∞</td></tr></tbody></table></div><h4 id=–¥–æ–±–∞–≤–ª—è–µ–º-–∞–∑–¥–µ–ª-—Å-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º>–î–æ–±–∞–≤–ª—è–µ–º –∞–∑–¥–µ–ª —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º</h4><p><strong>Volumes</strong> - <strong>Add Volume</strong>.<br>–¢–∏–ø <strong>Config Map Volume</strong>.</p><ul><li><code>Name</code> - onecci-root-ca</li><li><code>Mount path</code> - /etc/gitlab-ca</li></ul><h4 id=–¥–æ–±–∞–≤–ª—è–µ–º-yaml-–¥–ª—è-–∏–Ω–∏—Ç–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞-–∏-—É—Å—Ç–∞–Ω–æ–≤–∫–∏-sonar-scanner>–î–æ–±–∞–≤–ª—è–µ–º YAML –¥–ª—è –∏–Ω–∏—Ç–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ sonar-scanner</h4><p><strong>Raw YAML for the Pod</strong> - –≤—Å—Ç–∞–≤–ª—è–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sonar-scanner</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>emptyDir</span>: {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>initContainers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sonar-scanner-installer</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>sonarsource/sonar-scanner-cli:latest</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>command</span>: [<span style=color:#e6db74>&#39;sh&#39;</span>, <span style=color:#e6db74>&#39;-c&#39;</span>, <span style=color:#e6db74>&#39;cp -R /opt/sonar-scanner /sonar/&#39;</span>]
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sonar-scanner</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/sonar</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>jnlp</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>jenkins/inbound-agent:latest</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>volumeMounts</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>sonar-scanner</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>mountPath</span>: <span style=color:#ae81ff>/sonar</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>env</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>PATH</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;/sonar/sonar-scanner/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>GIT_SSL_CAINFO</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;/etc/gitlab-ca/onecci-root-ca.crt&#34;</span>
</span></span><span style=display:flex><span>        - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>SSL_CERT_FILE</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>value</span>: <span style=color:#e6db74>&#34;/etc/gitlab-ca/onecci-root-ca.crt&#34;</span>
</span></span></code></pre></div><h4 id=–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä-–∞–≥–µ–Ω—Ç–∞-1>–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∞–≥–µ–Ω—Ç–∞</h4><p>–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ä–∞–∑–¥–µ–ª—É <strong>Containers</strong> –∏ –∂–º–µ–º <strong>Add Container</strong> –∏ –≤—ã–±–∏—Ä–∞–µ–º <strong>Container Template</strong><br>–ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è:</p><div class=table-wrapper><table><thead><tr><th>–ü–æ–ª–µ</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th></tr></thead><tbody><tr><td>Name</td><td><code>jnlp</code></td><td>–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –∏–º–µ–Ω–µ–º <code>jnlp</code> –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Kubernetes plugin –∫–∞–∫ Jenkins-–∞–≥–µ–Ω—Ç</td></tr><tr><td>Docker image</td><td><code>jenkins/inbound-agent:latest</code></td><td>–ê–≥–µ–Ω—Ç Jenkins</td></tr><tr><td>Working directory</td><td><code>/home/jenkins</code></td><td>—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è Jenkins</td></tr><tr><td>Allocate pseudo-TTY</td><td>‚úÖ</td><td>–≤–∫–ª—é—á–∞–µ–º</td></tr><tr><td>Command</td><td></td><td>–Ω–µ –∑–∞–ø–æ–ª–Ω—è–µ–º, –¥–∞–µ–º –ø–ª–∞–≥–∏–Ω—É —Å–∞–º–æ–º—É –∑–∞–ø—É—Å–∫–∞—Ç—å –∞–≥–µ–Ω—Ç</td></tr><tr><td>Arguments</td><td></td><td>–Ω–µ –∑–∞–ø–æ–ª–Ω—è–µ–º, –Ω–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞–ø—É—Å–∫</td></tr></tbody></table></div><p><strong>Environment Variables</strong> - <strong>Add Environment Variable</strong>.<br>–î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å —Ç–∏–ø–æ–º <strong>Environment Variable</strong>.</p><div class=table-wrapper><table><thead><tr><th>Key</th><th>Value</th></tr></thead><tbody><tr><td>SONAR_SCANNER_JAVA_OPTS</td><td>-Xmx6g</td></tr><tr><td>PATH</td><td>/sonar/sonar-scanner/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</td></tr><tr><td>GIT_SSL_CAINFO</td><td>/etc/gitlab-ca/onecci-root-ca.crt</td></tr><tr><td>SSL_CERT_FILE</td><td>/etc/git-ssl/onecci-root-ca.crt</td></tr></tbody></table></div><p>–ù–∞–∂–∏–º–∞–µ–º <strong>Create</strong> –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.</p><h3 id=–ø–æ–¥–∫–ª—é—á–∞–µ–º-jenkins-lib>–ü–æ–¥–∫–ª—é—á–∞–µ–º Jenkins-lib</h3><p>–ú—ã –ø–æ–¥–æ—à–ª–∏ –∫ –∫—É–ª—å–º–∏–Ω–∞—Ü–∏–æ–Ω–Ω–æ–º—É –º–æ–º–µ–Ω—Ç—É.</p><p><strong>Manage Jenkins</strong> - <strong>System</strong></p><p>–ò—â–µ–º —Ä–∞–∑–¥–µ–ª <strong>Global Trusted Pipeline Libraries</strong> –∏ –Ω–∞–∂–∏–º–∞–µ–º <strong>+Add</strong>.</p><p>–ó–∞–ø–æ–ª–Ω—è–µ–º</p><div class=table-wrapper><table><thead><tr><th>–ü–æ–ª–µ</th><th>–ó–Ω–∞—á–µ–Ω–∏–µ</th><th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th></tr></thead><tbody><tr><td>Name</td><td>jenkins-lib</td><td>-</td></tr><tr><td>Default version</td><td>v0.16.0</td><td>–ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é</td></tr><tr><td>Load implicitly</td><td>‚úÖ</td><td>–ß—Ç–æ–±—ã —ç—Ç–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–ª–∞—Å—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</td></tr><tr><td>Retrieval method</td><td>Modern SCM</td><td>-</td></tr><tr><td>Source Code Management</td><td>Git</td><td>-</td></tr><tr><td>Project Repository</td><td><a class=link href=https://github.com/firstBitMarksistskaya/jenkins-lib target=_blank rel=noopener>https://github.com/firstBitMarksistskaya/jenkins-lib</a></td><td>-</td></tr></tbody></table></div><p>–ñ–º–µ–º <strong>Save</strong>.</p><h3 id=–ø–æ–¥–∫–ª—é—á–∞–µ–º-–Ω–æ–≤—ã–π-–ø—Ä–æ–µ–∫—Ç-–∫-–ø–∞–π–ø–ª–∞–π–Ω—É>–ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∫ –ø–∞–π–ø–ª–∞–π–Ω—É</h3><p>–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∏ –º—ã –≥–æ—Ç–æ–≤—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∞—à –ø—Ä–æ–µ–∫—Ç –∫ –ø–∞–π–ø–ª–∞–π–Ω—É.</p><p>–í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã –≤—ã–≥—Ä—É–∑–∏–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –≤ —Ñ–∞–π–ª—ã, –∑–∞–≥—Ä—É–∑–∏–º –∏—Ö –≤ –≥–∏—Ç–ª–∞–± –∏ –ø–æ–¥–∫–ª—é—á–∏–º –∫ –ø–∞–π–ø–ª–∞–π–Ω—É.</p><h3 id=—Å–æ–∑–¥–∞–µ–º-–ø—Ä–æ–µ–∫—Ç-–≤-gitlab>–°–æ–∑–¥–∞–µ–º –ø—Ä–æ–µ–∫—Ç –≤ GitLab</h3><p>–ò–¥–µ–º –≤ GitLab.</p><p><strong>Projects</strong> - <strong>New Project</strong> - <strong>Create blank project</strong>.</p><p><strong>Project name</strong> - demodb (–ª—é–±–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ, –ª—É—á—à–µ –ø–æ –∏–º–µ–Ω–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏).</p><p><strong>Visibility level</strong> - Internal</p><p>–£–±—Ä–∞—Ç—å –≥–∞–ª–∫—É <code>Initialize repository with a README</code>.</p><p>–ñ–º–µ–º <strong>Create project</strong>.</p><h3 id=–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞-–≤-–ª–æ–∫–∞–ª—å–Ω—ã–π-–∫–∞—Ç–∞–ª–æ–≥>–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥</h3><p>–í GitLab –º—ã —É–∂–µ –ø—É—Å—Ç–æ–π –ø—Ä–æ–µ–∫—Ç, —Å–µ–π—á–∞—Å —Å–æ–∑–¥–∞–¥–∏–º —É —Å–µ–±—è –ø–∞–ø–∫—É –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞, –∫–ª–æ–Ω–∏—Ä—É–µ–º —Ç—É–¥–∞ –ø—Ä–æ–µ–∫—Ç –∏–∑ GitLab, –ø–æ—Ç–æ–º –≤—ã–≥—Ä—É–∑–∏–º –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –æ—Ç–ø—Ä–∞–≤–∏–º –æ–±—Ä–∞—Ç–Ω–æ –≤ GitLab.</p><p>–ö —ç—Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–∏ —É–∂–µ –¥–æ–ª–∂–Ω–æ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ 1–°, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è, –∞ —Ç–∞–∫ –∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω OneScript.</p><p>–ü—Ä–∏–≤–µ–¥—É –≤–∞—Ä–∏–∞–Ω—Ç —Ä–∞–±–æ—Ç—ã –∏–∑ Windows.</p><h4 id=–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ-–ø—Ä–æ–µ–∫—Ç–∞-–≤-–ª–æ–∫–∞–ª—å–Ω—ã–π-–∫–∞—Ç–∞–ª–æ–≥-windows>–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ Windows</h4><p>–°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –Ω–∞ –º–∞—à–∏–Ω–µ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π. –ù–∞–ø—Ä–∏–º–µ—Ä <code>C:\GitRepo</code></p><p>–í —ç—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ gitsync –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–∞–π–ª—ã –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.</p><p>–í–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –ø–∞–ø–∫–∏, –∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ –∫–ª–æ–Ω–∏—Ä—É–µ–º –ø—Ä–æ–µ–∫—Ç git, –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è demodb.</p><pre tabindex=0><code>git clone https://gitlab.onecci.lan/one-c/demodb.git
</code></pre><p>–ü–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–≤–µ—Å—Ç–∏ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.</p><p>–ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –ø–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ git, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π –Ω–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–≥–¥–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–¥–ø–∞–ø–æ–∫ –∏ —Ñ–∞–π–ª–æ–≤ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏. –°–æ–∑–¥–∞–≤–∞—Ç—å –ø–∞–ø–∫–∏ –∏ —Ñ–∞–π–ª—ã –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏–≤ Visual Studio Code –∏–∑ –ø–∞–ø–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.</p><h4 id=–≥–æ—Ç–æ–≤–∏–º-–ø–∞–ø–∫—É-–ø—Ä–æ–µ–∫—Ç–∞-–∫-–≤—ã–≥—Ä—É–∑–∫–µ-—Ñ–∞–π–ª–æ–≤-–∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤-1—Å>–ì–æ—Ç–æ–≤–∏–º –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –∫ –≤—ã–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–æ–≤ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ 1–°</h4><p>–í–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ –Ω–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–µ–º –∫–∞—Ç–∞–ª–æ–≥ <code>src/cf</code>, —Å—é–¥–∞ –±—É–¥—É—Ç –≤—ã–≥—Ä—É–∂–∞—Ç—å—Å—è —Ñ–∞–π–ª—ã –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.</p><p>–í–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª <code>AUTHORS</code>, —ç—Ç–æ —Ñ–∞–π–ª —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –∏–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ GitLab. –í—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ GitLab.</p><p>–ü—Ä–∏–º–µ—Ä–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ñ–∞–π–ª–∞.</p><pre tabindex=0><code>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä=root &lt;root@example.com&gt;
User=user &lt;user@example.com&gt;
</code></pre><p>–ó–¥–µ—Å—å –∂–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è —Ñ–∞–π–ª <code>VERSION</code>. –£–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Ä—Å–∏—é 0, —ç—Ç–æ –∑–Ω–∞—á–∏—Ç gisync –±—É–¥–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤–µ—Ä—Å–∏–∏ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.</p><pre tabindex=0><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
&lt;VERSION&gt;0&lt;/VERSION&gt;
</code></pre><h4 id=–¥–æ–±–∞–≤–ª—è–µ–º-—Ñ–∞–π–ª—ã-–Ω–∞—Å—Ç—Ä–æ–µ–∫-–ø–∞–π–ø–ª–∞–π–Ω–∞>–î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞</h4><p>–í –∫–∞—Ç–∞–ª–æ–≥–µ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º –ø—Ä–æ–µ–∫—Ç–∞ (<code>C:\GitRepo</code>) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å 3 —Ñ–∞–π–ª–∞ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –ø–∞–π–ø–ª–∞–π–Ω–∞.</p><ol><li><code>jobConfiguration.json</code>, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;$schema&#34;</span>: <span style=color:#e6db74>&#34;https://raw.githubusercontent.com/firstBitMarksistskaya/jenkins-lib/master/resources/schema.json&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;v8version&#34;</span>: <span style=color:#e6db74>&#34;8.3.27.1606&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;stages&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;sonarqube&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><strong>v8version</strong>, —ç—Ç–æ –≤–µ—Ä—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.</li><li><strong>sonarqube</strong>, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —à–∞–≥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ sonarqube.</li></ul><ol start=2><li><code>Jenkinsfile</code>, –æ–ø–∏—Å–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–ª—è 1–°.</li></ol><pre tabindex=0><code>pipeline1C()
</code></pre><ol start=3><li><code>sonar-project.properties</code> - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è sonarqube.</li></ol><pre tabindex=0><code>sonar.projectKey=demodb
sonar.projectName=demodb

sonar.sources=src/cf

sonar.sourceEncoding=UTF-8

sonar.inclusions=**/*.bsl
sonar.cpd.exclusions=**/\u0420\u0435\u0433\u043b\u0430\u043c\u0435\u043d\u0442\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439\u041e\u0442\u0447\u0435\u0442*/**/*.*

sonar.bsl.languageserver.skipSupport=with support locked
</code></pre><ul><li><strong>sonar.projectKey</strong> - –∫–ª—é—á –ø—Ä–æ–µ–∫—Ç–∞</li><li><strong>sonar.projectName</strong> - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</li><li><strong>sonar.sources</strong> - –ø—É—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞–º</li><li><strong>sonar.sourceEncoding</strong> - –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤</li><li><strong>sonar.inclusions</strong> - –º–∞—Å–∫–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤</li><li><strong>sonar.cpd.exclusions</strong> - –º–∞—Å–∫–∞ –∏—Å–∫–ª—é—á–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ <code>–†–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π–û—Ç—á–µ—Ç</code>, –≤ –Ω–∏—Ö —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –¥—É–±–ª–µ–π –∫–æ–¥–∞)</li><li><strong>sonar.bsl.languageserver.skipSupport</strong> - <code>with support locked</code> –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ñ–∞–π–ª–æ–≤ –Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –±–µ–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.</li></ul><h4 id=–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º-–∏–∑–º–µ–Ω–µ–Ω–∏—è-–≤-gitlab>–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ GitLab</h4><p>–ö–æ–º–º–∏—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è, —É–¥–æ–±–Ω–æ —ç—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ –∏–∑ VSCode.</p><p>–ï—Å–ª–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –æ—à–∏–±–∫–∞</p><pre tabindex=0><code>fatal: unsafe repository (&#39;/home/mc/demodb&#39; is owned by someone else)
To add an exception for this directory, call:

        git config --global --add safe.directory /home/mc/demodb
</code></pre><p>–í—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—É—é –∫–æ–º–∞–Ω–¥—É</p><pre tabindex=0><code>git config --global --add safe.directory /home/mc/demodb
</code></pre><p>–ò –ø–æ–≤—Ç–æ—Ä—è–µ–º</p><pre tabindex=0><code>git add .
</code></pre><p>–ó–¥–µ—Å—å —Ç–æ–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—è–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏</p><pre tabindex=0><code>Author identity unknown

*** Please tell me who you are.

Run

  git config --global user.email &#34;you@example.com&#34;
  git config --global user.name &#34;Your Name&#34;

to set your account&#39;s default identity.
Omit --global to set the identity only in this repository.
</code></pre><p>–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã</p><pre tabindex=0><code>git config --global user.name root
</code></pre><p>–ì–¥–µ <code>root</code>, —ç—Ç–æ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p><pre tabindex=0><code>git config --global user.email root@example.com
</code></pre><p>–ì–¥–µ <code>root@example.com</code>, —ç—Ç–æ –∏–º–µ–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p><p>–ü–æ–≤—Ç–æ—Ä—è–µ–º</p><pre tabindex=0><code>git commit -m &#34;init&#34;
</code></pre><p>–ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π –æ—Ç–≤–µ—Ç</p><pre tabindex=0><code>[main (root-commit) a750612] init
 2 files changed, 4 insertions(+)
 create mode 100755 src/cf/AUTHORS
 create mode 100755 src/cf/VERSION
</code></pre><p>–¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º</p><pre tabindex=0><code>git push
</code></pre><p>–í–≤–æ–¥–∏–º –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –æ—Ç GitLab.</p><p>–ì–æ—Ç–æ–≤–æ. –í Gitlab —É –Ω–∞—Å –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∞ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–∞—Ç–∞–ª–æ–≥–µ –ø–∞–ø–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ —ç–∫—Å–ø–æ—Ä—Ç—É –≤–µ—Ä—Å–∏–π –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.</p><h3 id=gitsync-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞-1—Å-–∏-git>Gitsync, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –•—Ä–∞–Ω–∏–ª–∏—â–∞ 1–° –∏ Git</h3><p>–ü–æ–∫–∞ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º, –±—É–¥–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ 1–° –≤ –ø—Ä–æ–µ–∫—Ç git.
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Ç–∏–ª–∏—Ç—ã Gitsync (–≤—Ö–æ–¥–∏—Ç –≤ –ø–∞–∫–µ—Ç OneScript).
–≠—Ç–∞ —É—Ç–∏–ª–∏—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—É 1–° –¥–ª—è —Ä–∞–±–æ—Ç—ã, –ø–æ—ç—Ç–æ–º—É –Ω–∞ –º–∞—à–∏–Ω–µ —Å Gitsync –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –ª–∏—Ü–µ–Ω–∑–∏–∏ (–ø–æ–¥–æ–π–¥–µ—Ç –ª–∏—Ü–µ–Ω—â–∏—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞).</p><p>–†–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –±—É–¥–µ–º –≤–∞—Ä–∏–∞–Ω—Ç —Ä–∞–±–æ—Ç—ã –∏–∑ Windows.</p><h4 id=—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º-gitsync>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Gitsync</h4><p>–ù–∞ –º–æ–º–µ–Ω—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Gitsync —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω OneScript.</p><p>–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Gitsync</p><pre tabindex=0><code>opm install gitsync
</code></pre><p>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤.</p><pre tabindex=0><code>gitsync plugins init
</code></pre><p>–°–º–æ—Ç—Ä–∏–º —Å–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤.</p><pre tabindex=0><code>gitsync plugins ls -a
</code></pre><p>–í–∫–ª—é—á–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –º–∏–Ω–∏–º—É–º –ø–ª–∞–≥–∏–Ω–æ–≤.</p><pre tabindex=0><code>gitsync p e increment limit check-authors sync-remote
</code></pre><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º.</p><pre tabindex=0><code>gitsync plugins ls
</code></pre><p>–î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π —Å–ø–∏—Å–æ–∫, –ø–ª–∞–≥–∏–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ <code>[on]</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-powershell data-lang=powershell><span style=display:flex><span>–ö–∞—Ç–∞–ª–æ–≥ –ø–ª–∞–≥–∏–Ω–æ–≤<span style=color:#960050;background-color:#1e0010>:</span> &lt;/home/administrator/.local/share/gitsync/plugins&gt;
</span></span><span style=display:flex><span>–°–ø–∏—Å–æ–∫ –ø–ª–∞–≥–∏–Ω–æ–≤<span style=color:#960050;background-color:#1e0010>:</span>
</span></span><span style=display:flex><span> [<span style=color:#66d9ef>on] [1.3.0</span>] - increment - –ü–ª–∞–≥–∏–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
</span></span><span style=display:flex><span> [<span style=color:#66d9ef>on] [1.3.0</span>] - limit - –ü–ª–∞–≥–∏–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –≤–µ—Ä—Å–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∞ —Ç–∞–∫ –∂–µ –Ω–∞ –ª–∏–º–∏—Ç –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—ã–≥—Ä—É–∂–∞–µ–º—ã—Ö –≤–µ—Ä—Å–∏–π –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—É—Å–∫
</span></span><span style=display:flex><span> [<span style=color:#66d9ef>on] [1.3.0</span>] - check-authors - –ü–ª–∞–≥–∏–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∞ –≤–µ—Ä—Å–∏–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Ñ–∞–π–ª–∞ AUTHORS
</span></span><span style=display:flex><span> [<span style=color:#66d9ef>on] [1.3.0</span>] - sync-remote - –ü–ª–∞–≥–∏–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º git
</span></span></code></pre></div><h4 id=–≤—ã–ø–æ–ª–Ω—è–µ–º-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é>–í—ã–ø–æ–ª–Ω—è–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é</h4><p>–í–∞—Ä–∏–∞–Ω—Ç—ã –∑–∞–ø—É—Å–∫–∞ –∏–∑ windows, –ø–∞–ø–∫–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–µ—Ç–µ–≤–∞—è, –ø–∞–ø–∫–∞ –≥–∏—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-powershell data-lang=powershell><span style=display:flex><span>gitsync sync -u gitsync \\ubuntuserver1\onecrep C:\gitrep\erp\src\cf
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-powershell data-lang=powershell><span style=display:flex><span>gitsync --v8version <span style=color:#e6db74>&#34;8.3.27.1606&#34;</span> --ibconnection /S<span style=color:#e6db74>&#34;SERVER1C\serverbase&#34;</span> sync -u gitsync \\ubuntuserver1\onecrep C:\GitRepo\demodb\src\cf
</span></span></code></pre></div><ul><li><code>--v8version</code> - —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º –≤–µ—Ä—Å–∏—é –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.</li><li><code>gitsync</code>- –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞;</li><li><code>\\ubuntuserver1\onecrep</code> - –ø—É—Ç—å –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É 1—Å.</li><li><code>C:\gitrep\erp\src\cf</code>- –ø—É—Ç—å –∫ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é.</li><li><code>--ibconnection</code> - —Ñ–ª–∞–≥ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –±–∞–∑—ã –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏</li><li><code>/S"SERVER1C\serverbase"</code> - –ø—É—Ç—å –∫ —Å–µ—Ç–µ–≤–æ–π –±–∞–∑–µ, SERVER1C –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞, serverbase –∏–º—è –±–∞–∑—ã.</li></ul><p>–í–∞—Ä–∏–∞–Ω—Ç –∑–∞–ø—É—Å–∫–∞ –∏–∑ windows –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-powershell data-lang=powershell><span style=display:flex><span>gitsync --verbose --v8version <span style=color:#e6db74>&#34;8.3.27.1606&#34;</span> --ibconnection /S<span style=color:#e6db74>&#34;SRUMOWWAA001\gitsync&#34;</span> sync -u gitsync --ext –ö–æ–Ω–Ω–µ–∫—Ç \\ubuntuserver1\connect C:\gitrep\erp\src\cfe\connect
</span></span></code></pre></div><ul><li><code>--ext</code> - —Ñ–ª–∞–≥, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π —á—Ç–æ —ç—Ç–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ.</li><li><code>–ö–æ–Ω–Ω–µ–∫—Ç</code> - –ò–º—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, —Å –∫–æ—Ç–æ—Ä—ã–º –æ–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–æ –≤ –±–∞–∑–µ.</li><li><code>\\ubuntuserver1\connect</code> - –ø—É—Ç—å –∫ —Ö—Ä–∞–Ω–∏–ª–∏—â—É 1—Å.</li></ul><p>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏</p><ul><li><code>--verbose</code> - –ø—Ä–∏–∑–Ω–∞–∫ –æ—Ç–ª–∞–¥–∫–∏, –¥–ª—è –≤—ã–≤–æ–¥–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ.</li><li><code>--v8version "8.3.27.1606"</code> - –≤–µ—Ä—Å–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.</li><li><code>--ibconnection /S"myserver\gitsync"</code> - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Ä–≤–µ—Ä–Ω–æ–π –±–∞–∑—ã. –ü—É—Ç—å –∫ –±–∞–∑–µ —É–∫–∞–∑–∞–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ ‚Äú–ò–ú–Ø–°–ï–†–í–ï–†–ê\–ò–ú–Ø–ë–ê–ó–´‚Äù.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-powershell data-lang=powershell><span style=display:flex><span>C:\Windows\System32&gt;gitsync sync -u user H:\ C:\GitRepo\demodb\src\cf
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ù–∞—á–∞–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã &lt;sync&gt;
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ù–∞—á–∞—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å git
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ù–æ–º–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏<span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ù–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ<span style=color:#960050;background-color:#1e0010>:</span> <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –¥–ª—è –≤–µ—Ä—Å–∏–∏ <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>28.05</span>.2022 <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>42</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>14</span>
</span></span><span style=display:flex><span>WARNING<span style=color:#960050;background-color:#1e0010>:</span> Constructor of Console is obsolete. Use global property –ö–æ–Ω—Å–æ–ª—å/Console
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –û–ø—Ä–µ–¥–µ–ª—è—é —Ç–∏–ø –≤–æ–∑–º–æ–∂–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª—ã
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –¢–∏–ø –≤—ã–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª—ã<span style=color:#960050;background-color:#1e0010>:</span> –ü–û–õ–ù–ê–Ø –í–´–ì–†–£–ó–ö–ê
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –¥–ª—è –≤–µ—Ä—Å–∏–∏ <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>28.05</span>.2022 <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>42</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>35</span>
</span></span><span style=display:flex><span>WARNING<span style=color:#960050;background-color:#1e0010>:</span> Constructor of Console is obsolete. Use global property –ö–æ–Ω—Å–æ–ª—å/Console
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –û–ø—Ä–µ–¥–µ–ª—è—é —Ç–∏–ø –≤–æ–∑–º–æ–∂–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª—ã
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –¢–∏–ø –≤—ã–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª—ã<span style=color:#960050;background-color:#1e0010>:</span> –ò–ù–ö–†–ï–ú–ï–ù–¢–ê–õ–¨–ù–ê–Ø –í–´–ì–†–£–ó–ö–ê
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ü–æ–ª—É—á–∞–µ–º –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ –¥–ª—è –≤–µ—Ä—Å–∏–∏ <span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>28.05</span>.2022 <span style=color:#ae81ff>8</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>42</span><span style=color:#960050;background-color:#1e0010>:</span><span style=color:#ae81ff>47</span>
</span></span><span style=display:flex><span>WARNING<span style=color:#960050;background-color:#1e0010>:</span> Constructor of Console is obsolete. Use global property –ö–æ–Ω—Å–æ–ª—å/Console
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –û–ø—Ä–µ–¥–µ–ª—è—é —Ç–∏–ø –≤–æ–∑–º–æ–∂–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª—ã
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –¢–∏–ø –≤—ã–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª—ã<span style=color:#960050;background-color:#1e0010>:</span> –ò–ù–ö–†–ï–ú–ï–ù–¢–ê–õ–¨–ù–ê–Ø –í–´–ì–†–£–ó–ö–ê
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ó–∞–≤–µ—Ä—à–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å git
</span></span><span style=display:flex><span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø - –ó–∞–≤–µ—Ä—à–µ–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã &lt;sync&gt;
</span></span></code></pre></div><p>–¢–µ–ø–µ—Ä—å –ø—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä gitlab.</p><pre tabindex=0><code>git push
</code></pre><h3 id=–¥–æ–±–∞–≤–ª—è–µ-–ø–∞–π–ø–ª–∞–π–Ω-–≤-jenkins>–î–æ–±–∞–≤–ª—è–µ –ø–∞–π–ø–ª–∞–π–Ω –≤ Jenkins</h3><p>–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Jenkins.</p><p><strong>Dashboard</strong> - <strong>New Item</strong></p><p>–ó–∞–ø–æ–ª–Ω—è–µ–º <strong>Enter an item name</strong>, –Ω–∞–ø—Ä–∏–º–µ—Ä <code>demodb</code>.</p><p>–í—ã–±–∏—Ä–∞–µ–º <strong>Multibranch Pipeline</strong>.</p><p>–ñ–º–µ–º <strong>OK</strong>.</p><p>–û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ–∫–Ω–æ –Ω–∞—à–µ–≥–æ –ø–∞–π–ø–ª–∞–π–Ω–∞. –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª—è.</p><p>Display Name</p><p><strong>Branch Sources</strong> - <strong>Add Source</strong> –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ –≤—ã–±–∏—Ä–∞–µ–º <strong>Git</strong>.</p><p>Project Repository - <code>https://gitlab.onecci.lan/one-c/demodb.git</code>, –ü—É—Ç—å –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –≤ GitLab.</p><p><strong>Credentials</strong>, –≤—ã–±–∏—Ä–∞–µ–º <strong>Jenkins</strong>.</p><p>–í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ –¥–æ–±–∞–≤–ª—è–µ–º –∏–º—è –∏ –ø–∞—Ä–æ–ª—å –æ—Ç git (<code>root</code>). <strong>Description</strong> - <strong>root gitlab password</strong>.</p><p>–ñ–º–µ–º <strong>Add</strong>, –≤—ã–±–∏—Ä–∞–µ–º –≤ —Å–ø–∏—Å–∫–µ —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã.</p><p>–ü—Ä–æ–≤–µ—Ä—è–µ–º <strong>Build configuration</strong>. <strong>Mode</strong> –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å <strong>by Jenkinsfile</strong>, –∞ <strong>Script Path</strong> - <strong>Jenkinsfile</strong>, –∫–∞–∫ —Ñ–∞–π–ª –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.</p><p>–ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ - <strong>Scan Multibranch Pipeline Triggers</strong> - –°—Ç–∞–≤–∏–º –≥–∞–ª–∫—É –≤ –ø—É–Ω–∫—Ç–µ <strong>Periodically if not otherwise run</strong>. –ò–Ω—Ç–µ—Ä–≤–∞–ª 60 –º–∏–Ω—É—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä.</p><p>–ñ–º–µ–º <strong>Save</strong>.</p><p>–¢–µ–ø–µ—Ä—å –º–æ–∂–µ–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫, –∞ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤ sonarqube —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏.</p><p>üéÜ</p><h2 id=faq>FAQ</h2><h3 id=–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å-—Å–ø–∏—Å–æ–∫-namespace>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ namespace</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get ns
</span></span></code></pre></div><h3 id=–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å-—Å–ø–∏—Å–æ–∫-–ø–æ–¥–æ–≤-–≤-namespace>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–¥–æ–≤ –≤ namespace</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get pods -n &lt;namespace&gt;
</span></span></code></pre></div><h3 id=–ø—Ä–æ–≤–µ—Ä–∏—Ç—å-—Å—Ç–∞—Ç—É—Å-–ø–æ–¥–∞>–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∞</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;
</span></span></code></pre></div><h3 id=—É–¥–∞–ª–∏—Ç—å-–ø–æ–¥>–£–¥–∞–ª–∏—Ç—å –ø–æ–¥</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete pod &lt;pod-name&gt; -n &lt;namespace&gt;
</span></span></code></pre></div><h2 id=—É–¥–∞–ª—è–µ–º-helm-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–∏–∑-k3s>–£–¥–∞–ª—è–µ–º Helm-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ k3s</h2><p>–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π. –ü–æ–¥—Ö–æ–¥–∏—Ç <strong>–¥–ª—è –ª—é–±–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ k3s</strong>, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ —á–µ—Ä–µ–∑ Helm (GitLab, Jenkins, SonarQube –∏ —Ç.–¥.). –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã <strong>–¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —É–¥–∞–ª–µ–Ω–∏—è</strong>.</p><h3 id=–≤–∞—Ä–∏–∞–Ω—Ç-a-–±—ã—Å—Ç—Ä—ã–π-reset-—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è>–í–∞—Ä–∏–∞–Ω—Ç A. –ë—ã—Å—Ç—Ä—ã–π reset (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</h3><p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏:</p><ul><li>–¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–µ—Ç –∏–ª–∏ –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã;</li><li>namespace –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è <strong>—Ç–æ–ª—å–∫–æ</strong> —ç—Ç–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º;</li><li>—Ü–µ–ª—å - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–Ω–µ—Å—Ç–∏ –∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–Ω–æ–≤–æ –±–µ–∑ –æ—Ç–ª–∞–¥–∫–∏.</li></ul><h4 id=—à–∞–≥-a1-—É–¥–∞–ª—è–µ–º-namespace-—Ü–µ–ª–∏–∫–æ–º>–®–∞–≥ A1. –£–¥–∞–ª—è–µ–º namespace —Ü–µ–ª–∏–∫–æ–º</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete namespace &lt;namespace&gt;
</span></span></code></pre></div><p>–î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.</p><p>–ß—Ç–æ —Å–¥–µ–ª–∞–µ—Ç Kubernetes:</p><ul><li>—É–¥–∞–ª–∏—Ç –≤—Å–µ pods;</li><li>—É–¥–∞–ª–∏—Ç –≤—Å–µ services;</li><li>—É–¥–∞–ª–∏—Ç –≤—Å–µ deployments / statefulsets / jobs;</li><li>—É–¥–∞–ª–∏—Ç –≤—Å–µ secrets –∏ configmaps;</li><li>—É–¥–∞–ª–∏—Ç –≤—Å–µ PVC, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º namespace.</li></ul><p>–≠—Ç–æ <strong>—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π</strong> –¥–ª—è homelab.</p><h3 id=–≤–∞—Ä–∏–∞–Ω—Ç-b-–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ-—É–¥–∞–ª–µ–Ω–∏–µ-shared--prod-namespace>–í–∞—Ä–∏–∞–Ω—Ç B. –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (shared / prod namespace)</h3><p>–í–∞—Ä–∏–∞–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–∏—Ö —É—Å–ª–æ–≤–∏—è—Ö:</p><ul><li>namespace –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏;</li><li>–Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–∞—Å—Ç—å —Ä–µ—Å—É—Ä—Å–æ–≤;</li><li>—Ç—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ Helm hooks.</li></ul><h4 id=—É–¥–∞–ª—è–µ–º-helm-release>–£–¥–∞–ª—è–µ–º Helm release</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm -n gitlab uninstall gitlab
</span></span></code></pre></div><p>–ü—Ä–æ–≤–µ—Ä–∫–∞:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>helm -n gitlab list
</span></span></code></pre></div><p>–û–∂–∏–¥–∞–µ–º–æ: –ø—É—Å—Ç–æ.</p><h4 id=–ø—Ä–æ–≤–µ—Ä—è–µ–º-—á—Ç–æ-workload—ã-–∏—Å—á–µ–∑–ª–∏>–ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ workload&rsquo;—ã –∏—Å—á–µ–∑–ª–∏</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n gitlab get pods
</span></span><span style=display:flex><span>kubectl -n gitlab get deploy
</span></span><span style=display:flex><span>kubectl -n gitlab get statefulset
</span></span><span style=display:flex><span>kubectl -n gitlab get job
</span></span></code></pre></div><p>–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n gitlab delete all --all
</span></span></code></pre></div><h4 id=—É–¥–∞–ª—è–µ–º-pvc-–≤–∞–∂–Ω–æ>–£–¥–∞–ª—è–µ–º PVC (–≤–∞–∂–Ω–æ)</h4><p>GitLab –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PersistentVolumeClaims. –û–Ω–∏ <strong>–Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</strong> –ø—Ä–∏ <code>helm uninstall</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n gitlab get pvc
</span></span></code></pre></div><p>–ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –Ω–µ –ø—É—Å—Ç–æ–π:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n gitlab delete pvc --all
</span></span></code></pre></div><h4 id=—É–¥–∞–ª—è–µ–º-secrets-–∏-configmaps>–£–¥–∞–ª—è–µ–º secrets –∏ configmaps</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n gitlab delete secret --all
</span></span><span style=display:flex><span>kubectl -n gitlab delete configmap --all
</span></span></code></pre></div><p>–°—é–¥–∞ –≤—Ö–æ–¥—è—Ç:</p><ul><li>root password secret;</li><li>TLS / CA secrets;</li><li>–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ secrets GitLab.</li></ul><h4 id=–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ-—É–¥–∞–ª—è–µ–º-namespace>(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –£–¥–∞–ª—è–µ–º namespace</h4><p>–ï—Å–ª–∏ –ø–æ—Å–ª–µ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–π —á–∏—Å—Ç–∫–∏ namespace –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl delete namespace gitlab
</span></span></code></pre></div><h3 id=–ø—Ä–æ–≤–µ—Ä–∫–∞-—á—Ç–æ-gitlab-—É–¥–∞–ª–µ–Ω-–ø–æ–ª–Ω–æ—Å—Ç—å—é>–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ GitLab —É–¥–∞–ª–µ–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl get all -A | grep -i gitlab <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;GitLab –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω&#34;</span>
</span></span><span style=display:flex><span>helm list -A | grep gitlab <span style=color:#f92672>||</span> echo <span style=color:#e6db74>&#34;Helm release –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç&#34;</span>
</span></span></code></pre></div></section><footer class=article-footer></footer></article><footer class=site-footer><section class=copyright>&copy;
2026 1C DevOps Jr</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>